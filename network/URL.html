<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>输入URL到页面的呈现 | 橘子</title>
    <meta name="generator" content="VuePress 1.4.1">
    <link rel="icon" href="/blog/favicon.ico">
    <link rel="manifest" href="/blog/manifest.json">
    <link rel="mask-icon" href="/blog/icons/safari-pinned-tab.svg" color="#3eaf7c">
    <meta name="description" content="明日可期">
    <meta name="author" content="bright">
    <meta name="keywords" content="前端 随记 笔记">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileColor" content="#000000">
    <link rel="preload" href="/blog/assets/css/0.styles.96e855cf.css" as="style"><link rel="preload" href="/blog/assets/js/app.846c2af7.js" as="script"><link rel="preload" href="/blog/assets/js/2.7baf1e30.js" as="script"><link rel="preload" href="/blog/assets/js/15.30a8a42b.js" as="script"><link rel="preload" href="/blog/assets/js/3.e02a7905.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.86785721.js"><link rel="prefetch" href="/blog/assets/js/11.26ca4aa6.js"><link rel="prefetch" href="/blog/assets/js/12.9280f5df.js"><link rel="prefetch" href="/blog/assets/js/13.491d5f4c.js"><link rel="prefetch" href="/blog/assets/js/14.06ac742d.js"><link rel="prefetch" href="/blog/assets/js/16.26f51be0.js"><link rel="prefetch" href="/blog/assets/js/17.79d2e86b.js"><link rel="prefetch" href="/blog/assets/js/18.3e102323.js"><link rel="prefetch" href="/blog/assets/js/19.3834056b.js"><link rel="prefetch" href="/blog/assets/js/20.e411308e.js"><link rel="prefetch" href="/blog/assets/js/21.68d4b979.js"><link rel="prefetch" href="/blog/assets/js/22.ba9b864c.js"><link rel="prefetch" href="/blog/assets/js/23.a4bf6015.js"><link rel="prefetch" href="/blog/assets/js/24.0e73f53a.js"><link rel="prefetch" href="/blog/assets/js/25.7766fb26.js"><link rel="prefetch" href="/blog/assets/js/26.3cd2ed30.js"><link rel="prefetch" href="/blog/assets/js/27.e2861c31.js"><link rel="prefetch" href="/blog/assets/js/28.565b27ef.js"><link rel="prefetch" href="/blog/assets/js/29.81874df5.js"><link rel="prefetch" href="/blog/assets/js/4.c7236fd3.js"><link rel="prefetch" href="/blog/assets/js/5.956a0a9c.js"><link rel="prefetch" href="/blog/assets/js/6.783055ce.js"><link rel="prefetch" href="/blog/assets/js/7.29a4535f.js"><link rel="prefetch" href="/blog/assets/js/8.454ed7dd.js"><link rel="prefetch" href="/blog/assets/js/9.60594020.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.96e855cf.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">橘子</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/network/" class="nav-link router-link-active">
  浏览器
</a></div><div class="nav-item"><a href="/blog/note/ES6.html" class="nav-link">
  随记
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架" class="dropdown-title"><span class="title">框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/frame/Vue/base.html" class="nav-link">
  Vue
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/network/" class="nav-link router-link-active">
  浏览器
</a></div><div class="nav-item"><a href="/blog/note/ES6.html" class="nav-link">
  随记
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架" class="dropdown-title"><span class="title">框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/frame/Vue/base.html" class="nav-link">
  Vue
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>network</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/network/JSONP.html" class="sidebar-link">JSONP原理及实现</a></li><li><a href="/blog/network/Promise.html" class="sidebar-link">Promise</a></li><li><a href="/blog/network/PromiseTopic.html" class="sidebar-link">Promise由浅入深题目-加深理解</a></li><li><a href="/blog/network/" class="sidebar-link">浏览器相关</a></li><li><a href="/blog/network/URL.html" class="active sidebar-link">输入URL到页面的呈现</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/network/URL.html#回流" class="sidebar-link">回流</a></li><li class="sidebar-sub-header"><a href="/blog/network/URL.html#重绘" class="sidebar-link">重绘</a></li><li class="sidebar-sub-header"><a href="/blog/network/URL.html#合成" class="sidebar-link">合成</a></li><li class="sidebar-sub-header"><a href="/blog/network/URL.html#实践意义" class="sidebar-link">实践意义</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p>首先，在地址栏中输入了网址</p> <div class="language-html extra-class"><pre class="language-html"><code>https://www.baidu.com
</code></pre></div><p>然后中间需要经历哪些过程之后，页面才会呈现在我们眼前呢？</p> <h1 id="网络请求"><a href="#网络请求" class="header-anchor">#</a> 网络请求</h1> <h3 id="_1-构建请求"><a href="#_1-构建请求" class="header-anchor">#</a> 1.构建请求</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 请求的方法是 GET, 路径是根路径，HTTP协议版本是1.1</span>
<span class="token constant">GET</span> <span class="token operator">/</span> <span class="token constant">HTTP</span><span class="token operator">/</span><span class="token number">1.1</span>
</code></pre></div><h3 id="_2-查找强缓存"><a href="#_2-查找强缓存" class="header-anchor">#</a> 2.查找强缓存</h3> <p>先检查强缓存，如果命中则直接使用缓存，否则进入下一步</p> <h3 id="_3-dns解析"><a href="#_3-dns解析" class="header-anchor">#</a> 3.DNS解析</h3> <p>因为我们输入的是域名，而数据是通过<code>IP地址</code>进行传输，所以我们需要得到域名对应的<code>IP</code>，这个过程需要依赖一个系统，这个系统将域名和<code>IP</code>一一进行映射，我们把这个系统叫做<strong>DNS</strong>（域名系统），得到具体的<code>IP</code>的过程就叫做<strong>DNS解析</strong><br>
当然，浏览器提供了<strong>DNS数据缓存功能</strong>，即一个域名已经解析过，那么就会把解析的结果存下来，下次访问的时候直接走缓存，不需要再次进行<code>DNS解析</code><br>
如果不指名端口号的话，默认采用对应的 IP 的 80 端口</p> <h3 id="_4-建立tcp连接"><a href="#_4-建立tcp连接" class="header-anchor">#</a> 4.建立TCP连接</h3> <p><code>Chrome</code>在同一个域名下，同时最多只能有<code>6</code>个<code>TCP</code>连接，超过<code>6</code>个，剩下的连接就需要等待</p> <blockquote><p>TCP(Transmission Control Protocol, 传输控制协议)是一种面向连接的，可靠的，基于字节流的传输层通信协议</p></blockquote> <p>构建<code>TCP</code>连接需要经过以下几个阶段：</p> <ul><li>通过<strong>三次握手</strong>建立客户端和服务器之间的连接</li> <li>进行数据传输。数据传输中有一个比较重要的机制，就是接受方接收到数据包之后需要向发送方<code>确认</code>，如果发送方没有收到这个<code>确认</code>消息就会判定数据包丢失，并且重新发送该数据包，同时，发送过程中有一个优化策略，就是<code>大的数据包拆分成一个个的小包</code>，依次传输到接收方，接收方按照小包的顺序把它们<code>组装</code>完整的数据包</li> <li>断开连接的阶段，当数据传输完成之后，就要断开连接，通过<code>四次挥手</code>来断开连接</li></ul> <p><code>TCP</code>连接一是通过<code>三次握手</code>确认连接，二是通过<code>数据包校验</code>保证数据的传输，三是通过<code>四次挥手</code>断开连接</p> <p>关于<code>三次握手</code>与<code>四次挥手</code>更详细的解答可以看 <a href="https://zhuanlan.zhihu.com/p/86426969" target="_blank" rel="noopener noreferrer">解答<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="_5-发送http请求"><a href="#_5-发送http请求" class="header-anchor">#</a> 5.发送http请求</h3> <p>现在<code>tcp</code>连接已经建立完毕，浏览器和服务器可以进行通信，就开始发送<code>http</code>请求，浏览器<code>http</code>请求由<strong>请求行</strong>、<strong>请求头</strong>，<strong>空行</strong>和<strong>请求体</strong>组成
请求行很简单，由<strong>请求方式</strong>，<strong>请求路径</strong>和<strong>HTTP版本协议</strong>组成</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 请求的方法是 GET, 路径是根路径，HTTP协议版本是1.1</span>
<span class="token constant">GET</span> <span class="token operator">/</span> <span class="token constant">HTTP</span><span class="token operator">/</span><span class="token number">1.1</span>
</code></pre></div><p>请求头包括了<code>Cookie</code>,<code>Cache-Control</code>,<code>If-Modified-Since</code>,<code>If-None-Match</code>,<code>User-Agent</code>等信息</p> <p>请求体只有在<code>POST</code>方法下存在，常见的场景是表单提交</p> <h1 id="网络响应"><a href="#网络响应" class="header-anchor">#</a> 网络响应</h1> <p><code>HTTP</code>请求到达服务器，服务器进行相应的处理。最后要把数据传给浏览器，也就是返回网络响应<br>
和请求部分类似，响应部分包括了<strong>响应行</strong>，<strong>响应头</strong>和<strong>响应体</strong><br>
响应行由<code>HTTP协议版本</code>、<code>状态码</code>、<code>状态描述</code>组成</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token constant">HTTP</span><span class="token operator">/</span><span class="token number">1.1</span> <span class="token number">200</span> <span class="token constant">OK</span>
</code></pre></div><p>响应头包含了服务器返回的数据信息,比如说生成数据的时间，数据类型和Cookie等信息</p> <div class="language- extra-class"><pre class="language-text"><code>Cache-Control: no-cache
Connection: keep-alive
Content-Encoding: gzip
Content-Type: text/html;charset=utf-8
Date: Wed, 04 Dec 2019 12:29:13 GMT
Server: apache
Set-Cookie: rsv_i=f9a0SIItKqzv7kqgAAgphbGyRts3RwTg%2FLyU3Y5Eh5LwyfOOrAsvdezbay0QqkDqFZ0DfQXby4wXKT8Au8O7ZT9UuMsBq2k; path=/; domain=.baidu.com

</code></pre></div><p>响应完成之后，需要判断<code>Connection</code>字段，如果请求头或者响应头中包含了<code>Connection:Keep-Alive</code>，那么表示建立了持久连接，这样<code>TCP</code>连接会一直保持，之后请求统一站点的资源会复用这个连接，否则就断开连接，这个时候<strong>请求-响应</strong>的流程就结束了</p> <h1 id="资源解析，布局渲染"><a href="#资源解析，布局渲染" class="header-anchor">#</a> 资源解析，布局渲染</h1> <p>对于获取到的<code>HTML</code>, <code>CSS</code>, <code>JS</code>等资源，主要步骤是：</p> <ul><li>解析<code>HTML</code>，生成<code>DOM树</code></li> <li>解析<code>CSS</code>生成<code>CSS规则树</code></li> <li>通过<code>DOM树</code>和<code>CSS规则树</code>生成渲染树，渲染树中没有<code>display:none</code>的元素</li> <li>进行样式计算布局</li> <li>遍历渲染树，绘制页面</li></ul> <p>在浏览器还没完全接收到完整的<code>HTML</code>文件时，它就已经开始渲染页面了，在遇见外部链入的脚本标签或者样式标签或图片时，会再次发送<code>HTTP</code>请求重复上述步骤，在收到<code>CSS</code>文件后会对已经渲染的页面重新渲染，加入它们应有的样式，图片文件加载完会立即显示在正确的位置，这个过程中可能会触发页面的重绘和重排</p> <h1 id="重绘与重排"><a href="#重绘与重排" class="header-anchor">#</a> 重绘与重排</h1> <img src="/blog/Parsing.png" alt="Parsing" class="custom"> <h2 id="回流"><a href="#回流" class="header-anchor">#</a> 回流</h2> <p>先说一下<code>回流</code>，<code>回流</code>也叫<code>重排</code>。</p> <h3 id="触发条件"><a href="#触发条件" class="header-anchor">#</a> 触发条件</h3> <p>当我们对<code>DOM</code>的修改引发了<code>DOM</code>几何尺寸变化的时候，会发生<code>回流</code>过程
比如说，一下操作就会触发回流：</p> <ol><li>一个DOM元素的几何属性发生变化，常见的几何属性有 <code>width</code>, <code>height</code>, <code>padding</code>, <code>margin</code>, <code>left</code>, <code>top</code>, <code>border</code>等</li> <li>使DOM节点发生<code>增减</code>或者<code>移动</code></li> <li>读写<code>offset</code>族, <code>scroll</code>族, <code>client</code>族属性的时候，浏览器为了获取这些值，需要进行回流操作</li> <li>调用<code>window.getComputedStyle</code>方法</li></ol> <h3 id="回流过程"><a href="#回流过程" class="header-anchor">#</a> 回流过程</h3> <p>按照上面的流水线，触发回流的时候，如果DOM结构发生改变，则重新渲染DOM树，然后后面的流程（包括了主线程之外的任务）全部走一遍。相当于将解析和合成的过程又走了一遍，开销是非常大的。</p> <img src="/blog/reflow.png" alt="reflow" class="custom"> <h2 id="重绘"><a href="#重绘" class="header-anchor">#</a> 重绘</h2> <h3 id="触发条件-2"><a href="#触发条件-2" class="header-anchor">#</a> 触发条件</h3> <p>当DOM 的修改导致了样式的变化，并且没有影响几何属性的时候，会导致<code>重绘</code></p> <h3 id="重绘过程"><a href="#重绘过程" class="header-anchor">#</a> 重绘过程</h3> <p>由于没有导致DOM几何属性的更新，因此元素的位置信息不需要更新，从而省去布局的过程，流程</p> <img src="/blog/repaint.png" alt="repaint" class="custom"> <p>跳过了<code>生成布局树</code>和<code>建图层树</code>的阶段，直接生成绘制列表，然后继续进行分块、生成位图等后面一系列操作</p> <p>可以看到，重绘不一定导致回流，但是回流一定发生了重绘。</p> <h2 id="合成"><a href="#合成" class="header-anchor">#</a> 合成</h2> <p>还有一种情况是直接合成，比如利用CSS3的<code>transform</code>，<code>opacity</code>，<code>filter</code>这些属性是可以实现合成的效果，也就是常说的<strong>GPU加速</strong></p> <h3 id="gpu加速的原因"><a href="#gpu加速的原因" class="header-anchor">#</a> GPU加速的原因</h3> <p>在合成的情况下，会直接跳过布局和绘制流程，直接进入非主线程处理的部分，即直接交给<code>合成线程</code>处理。
交给它处理有两大好处:</p> <ol><li><p>能够充分发挥GPU的优势。合成线程生成位图的过程中会调用线程池，并在其中使用GPU进行加速生成，而GPU 是擅长处理位图数据的。</p></li> <li><p>没有占用主线程的资源，即使主线程卡住了，效果依然能够流畅地展示。</p></li></ol> <h2 id="实践意义"><a href="#实践意义" class="header-anchor">#</a> 实践意义</h2> <p>知道原理后，对开发过程的指导意义</p> <ol><li>避免频繁的使用<code>style</code>，而是采用<code>class</code>的方式</li> <li>使用<code>createDocumentFragment</code>进行批量的DOM操作</li> <li>对于<code>resize</code>,<code>scroll</code>等进行防抖/节流的处理</li> <li>添加 will-change: tranform ，让渲染引擎为其单独实现一个图层，当这些变换发生时，仅仅只是利用合成线程去处理这些变换，而不牵扯到主线程，大大提高渲染效率。当然这个变化不限于tranform, 任何可以实现合成效果的 CSS 属性都能用will-change来声明。有一个实际的例子，一行will-change: tranform拯救一个项目，<a href="https://juejin.im/post/5da52531518825094e373372" target="_blank" rel="noopener noreferrer">查看详情<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ol></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">更新时间:</span> <span class="time">2020年5月19日星期二晚上10点17分</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/network/" class="prev router-link-active">
        浏览器相关
      </a></span> <!----></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/blog/assets/js/app.846c2af7.js" defer></script><script src="/blog/assets/js/2.7baf1e30.js" defer></script><script src="/blog/assets/js/15.30a8a42b.js" defer></script><script src="/blog/assets/js/3.e02a7905.js" defer></script>
  </body>
</html>
