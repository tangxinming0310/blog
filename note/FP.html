<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>函数式编程(FP) | 橘子</title>
    <meta name="generator" content="VuePress 1.4.1">
    <link rel="icon" href="/blog/favicon.ico">
    <link rel="manifest" href="/blog/manifest.json">
    <link rel="mask-icon" href="/blog/icons/safari-pinned-tab.svg" color="#3eaf7c">
    <meta name="description" content="明日可期">
    <meta name="author" content="bright">
    <meta name="keywords" content="前端 随记 笔记">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileColor" content="#000000">
    <link rel="preload" href="/blog/assets/css/0.styles.96e855cf.css" as="style"><link rel="preload" href="/blog/assets/js/app.846c2af7.js" as="script"><link rel="preload" href="/blog/assets/js/2.7baf1e30.js" as="script"><link rel="preload" href="/blog/assets/js/18.3e102323.js" as="script"><link rel="preload" href="/blog/assets/js/3.e02a7905.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.86785721.js"><link rel="prefetch" href="/blog/assets/js/11.26ca4aa6.js"><link rel="prefetch" href="/blog/assets/js/12.9280f5df.js"><link rel="prefetch" href="/blog/assets/js/13.491d5f4c.js"><link rel="prefetch" href="/blog/assets/js/14.06ac742d.js"><link rel="prefetch" href="/blog/assets/js/15.30a8a42b.js"><link rel="prefetch" href="/blog/assets/js/16.26f51be0.js"><link rel="prefetch" href="/blog/assets/js/17.79d2e86b.js"><link rel="prefetch" href="/blog/assets/js/19.3834056b.js"><link rel="prefetch" href="/blog/assets/js/20.e411308e.js"><link rel="prefetch" href="/blog/assets/js/21.68d4b979.js"><link rel="prefetch" href="/blog/assets/js/22.ba9b864c.js"><link rel="prefetch" href="/blog/assets/js/23.a4bf6015.js"><link rel="prefetch" href="/blog/assets/js/24.0e73f53a.js"><link rel="prefetch" href="/blog/assets/js/25.7766fb26.js"><link rel="prefetch" href="/blog/assets/js/26.3cd2ed30.js"><link rel="prefetch" href="/blog/assets/js/27.e2861c31.js"><link rel="prefetch" href="/blog/assets/js/28.565b27ef.js"><link rel="prefetch" href="/blog/assets/js/29.81874df5.js"><link rel="prefetch" href="/blog/assets/js/4.c7236fd3.js"><link rel="prefetch" href="/blog/assets/js/5.956a0a9c.js"><link rel="prefetch" href="/blog/assets/js/6.783055ce.js"><link rel="prefetch" href="/blog/assets/js/7.29a4535f.js"><link rel="prefetch" href="/blog/assets/js/8.454ed7dd.js"><link rel="prefetch" href="/blog/assets/js/9.60594020.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.96e855cf.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">橘子</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/network/" class="nav-link">
  浏览器
</a></div><div class="nav-item"><a href="/blog/note/ES6.html" class="nav-link">
  随记
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架" class="dropdown-title"><span class="title">框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/frame/Vue/base.html" class="nav-link">
  Vue
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/network/" class="nav-link">
  浏览器
</a></div><div class="nav-item"><a href="/blog/note/ES6.html" class="nav-link">
  随记
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架" class="dropdown-title"><span class="title">框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/frame/Vue/base.html" class="nav-link">
  Vue
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>note</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/note/ES6.html" class="sidebar-link">ES 新特性</a></li><li><a href="/blog/note/EventLoop.html" class="sidebar-link">EventLoop</a></li><li><a href="/blog/note/FP.html" class="active sidebar-link">函数式编程(FP)</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/note/FP.html#函数式编程-fp" class="sidebar-link">函数式编程(FP)</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/note/FP.html#概念" class="sidebar-link">概念</a></li><li class="sidebar-sub-header"><a href="/blog/note/FP.html#优点" class="sidebar-link">优点</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/note/FP.html#函数是一等公民" class="sidebar-link">函数是一等公民</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/note/FP.html#函数可以存储在变量中" class="sidebar-link">函数可以存储在变量中</a></li><li class="sidebar-sub-header"><a href="/blog/note/FP.html#函数可以作为参数" class="sidebar-link">函数可以作为参数</a></li><li class="sidebar-sub-header"><a href="/blog/note/FP.html#函数可以作为返回值" class="sidebar-link">函数可以作为返回值</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/note/FP.html#高阶函数" class="sidebar-link">高阶函数</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/note/FP.html#可以把函数作为参数" class="sidebar-link">可以把函数作为参数</a></li><li class="sidebar-sub-header"><a href="/blog/note/FP.html#可以把函数作为返回结果" class="sidebar-link">可以把函数作为返回结果</a></li><li class="sidebar-sub-header"><a href="/blog/note/FP.html#高级函数的意义" class="sidebar-link">高级函数的意义</a></li><li class="sidebar-sub-header"><a href="/blog/note/FP.html#常用的高阶函数" class="sidebar-link">常用的高阶函数</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/note/FP.html#闭包" class="sidebar-link">闭包</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/note/FP.html#概念-2" class="sidebar-link">概念</a></li><li class="sidebar-sub-header"><a href="/blog/note/FP.html#案例" class="sidebar-link">案例</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/note/FP.html#纯函数" class="sidebar-link">纯函数</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/note/FP.html#概念-3" class="sidebar-link">概念</a></li><li class="sidebar-sub-header"><a href="/blog/note/FP.html#lodash" class="sidebar-link">lodash</a></li><li class="sidebar-sub-header"><a href="/blog/note/FP.html#优点-2" class="sidebar-link">优点</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/note/FP.html#副作用" class="sidebar-link">副作用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/note/FP.html#概念-4" class="sidebar-link">概念</a></li><li class="sidebar-sub-header"><a href="/blog/note/FP.html#来源" class="sidebar-link">来源</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/note/FP.html#柯里化" class="sidebar-link">柯里化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/note/FP.html#概念-5" class="sidebar-link">概念</a></li><li class="sidebar-sub-header"><a href="/blog/note/FP.html#lodash中的柯里化函数curry" class="sidebar-link">lodash中的柯里化函数curry</a></li><li class="sidebar-sub-header"><a href="/blog/note/FP.html#总结" class="sidebar-link">总结</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/note/FP.html#函数组合" class="sidebar-link">函数组合</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/note/FP.html#管道" class="sidebar-link">管道</a></li><li class="sidebar-sub-header"><a href="/blog/note/FP.html#函数组合-2" class="sidebar-link">函数组合</a></li><li class="sidebar-sub-header"><a href="/blog/note/FP.html#lodash中的组合函数" class="sidebar-link">lodash中的组合函数</a></li><li class="sidebar-sub-header"><a href="/blog/note/FP.html#lodash中flowright实现" class="sidebar-link">lodash中flowRight实现</a></li><li class="sidebar-sub-header"><a href="/blog/note/FP.html#函数组合的调试" class="sidebar-link">函数组合的调试</a></li><li class="sidebar-sub-header"><a href="/blog/note/FP.html#lodash中的fp模块" class="sidebar-link">lodash中的fp模块</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/note/FP.html#point-free" class="sidebar-link">Point Free</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/note/FP.html#概念-6" class="sidebar-link">概念</a></li><li class="sidebar-sub-header"><a href="/blog/note/FP.html#案例-3" class="sidebar-link">案例</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/note/FP.html#functor（函子）" class="sidebar-link">Functor（函子）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/note/FP.html#概念-7" class="sidebar-link">概念</a></li><li class="sidebar-sub-header"><a href="/blog/note/FP.html#functor-函子" class="sidebar-link">Functor 函子</a></li><li class="sidebar-sub-header"><a href="/blog/note/FP.html#总结-2" class="sidebar-link">总结</a></li><li class="sidebar-sub-header"><a href="/blog/note/FP.html#maybe函子" class="sidebar-link">MayBe函子</a></li><li class="sidebar-sub-header"><a href="/blog/note/FP.html#either函子" class="sidebar-link">Either函子</a></li><li class="sidebar-sub-header"><a href="/blog/note/FP.html#io-函子" class="sidebar-link">IO 函子</a></li><li class="sidebar-sub-header"><a href="/blog/note/FP.html#folktale-一个标准的函数式编程库" class="sidebar-link">folktale(一个标准的函数式编程库)</a></li><li class="sidebar-sub-header"><a href="/blog/note/FP.html#folktale库中提供的task函子" class="sidebar-link">folktale库中提供的Task函子</a></li><li class="sidebar-sub-header"><a href="/blog/note/FP.html#pointed函子" class="sidebar-link">Pointed函子</a></li><li class="sidebar-sub-header"><a href="/blog/note/FP.html#monad函子" class="sidebar-link">Monad函子</a></li></ul></li></ul></li><li><a href="/blog/note/JS性能优化.html" class="sidebar-link">JS性能优化</a></li><li><a href="/blog/note/Promise.html" class="sidebar-link">Promise源码实现诱导版</a></li><li><a href="/blog/note/" class="sidebar-link">日常随记</a></li><li><a href="/blog/note/Rollup.html" class="sidebar-link">Rollup</a></li><li><a href="/blog/note/TS.html" class="sidebar-link">TypeScript</a></li><li><a href="/blog/note/webpack.html" class="sidebar-link">Webpack</a></li><li><a href="/blog/note/工程化.html" class="sidebar-link">工程化</a></li><li><a href="/blog/note/脚手架工具.html" class="sidebar-link">脚手架工具</a></li><li><a href="/blog/note/自动化构建.html" class="sidebar-link">自动化构建</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="函数式编程-fp"><a href="#函数式编程-fp" class="header-anchor">#</a> 函数式编程(FP)</h2> <h3 id="概念"><a href="#概念" class="header-anchor">#</a> 概念</h3> <p>简单来说，函数式编程(Functional Programming)就是利用纯函数实现细粒度函数，再通过函数组合，实现功能强大的函数
具体一点，就是把现实世界的事物与事物之间的联系抽象到程序世界（抽象运算过程），主要有以下几点：</p> <ul><li>程序的本质：根据输入通过某种运算获得相应的输出</li> <li><code>x -&gt; f(联系，映射) -&gt; y, y=f(x)</code></li> <li>函数式编程中的函数指的不是程序中的函数**，而是数学中的<strong>映射</strong>关系，例如：<code>y=sin(x)</code>，<code>x</code>和<code>y</code>的关系</li> <li><strong>相同的输入始终会得到相同的输出</strong>（纯函数）</li> <li>函数式编程用来描述数据（函数）之间的映射</li></ul> <h3 id="优点"><a href="#优点" class="header-anchor">#</a> 优点</h3> <ul><li>函数式编程可以抛弃<code>this</code></li> <li>打包过程中可以更好的利用<code>tree shaking</code>过滤掉无用代码</li> <li>方便测试以及并行处理</li> <li><code>Vue3</code>以及<code>React</code>都趋向于函数式编程</li></ul> <p>先举个简单的例子：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 计算两个数的和</span>
<span class="token comment">// 非函数式</span>
<span class="token keyword">let</span> num1 <span class="token operator">=</span> <span class="token number">2</span>
<span class="token keyword">let</span> num2 <span class="token operator">=</span> <span class="token number">3</span>
<span class="token keyword">let</span> sum <span class="token operator">=</span> num1 <span class="token operator">+</span> num2
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>sum<span class="token punctuation">)</span>

<span class="token comment">// 函数式</span>
<span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">n1<span class="token punctuation">,</span> n2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> n1 <span class="token operator">+</span> n2
<span class="token punctuation">}</span>
<span class="token keyword">let</span> sum <span class="token operator">=</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>sum<span class="token punctuation">)</span>
</code></pre></div><p>在举个实际开发中的例子：</p> <p>有这样一种场景，有两个页面</p> <img src="/blog/img/page.png" alt="queue" class="custom"> <p>页面<code>A</code>和页面<code>B</code>，两个页面布局形式差不多，然后每个页面分为两个部分，上面部分横着排，每个元素显示名称<code>name</code>和描述<code>desc</code>，下面部分竖着排，然后也显示名称<code>name</code>和描述<code>desc</code>，然后多显示一个关系<code>ship</code>，</p> <p>我们可能会把上面部分每个元素抽取成一个组件，然后传递值，然后下面的部分的元素也抽取成组件，把要显示的字段传递进去</p> <p>两个页面请求不同的接口，每个接口返回两个`list``</p> <p><code>A</code>页面的接口返回<code>familyList</code>和<code>pretectionList</code></p> <p><code>B</code>页面的接口返回<code>homeList</code>和<code>inviteList</code>
我们可能会这么去写</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 在A页面中</span>
<span class="token keyword">let</span> familyList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">let</span> pretectionList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">function</span> <span class="token function">initListData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">requestFamilyList</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> 
      familyList <span class="token operator">=</span> result<span class="token punctuation">.</span>familyList<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">list<span class="token punctuation">,</span> family</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> item <span class="token operator">=</span> <span class="token punctuation">{</span>
          name<span class="token operator">:</span> family<span class="token punctuation">.</span>name<span class="token punctuation">,</span>
          desc<span class="token operator">:</span> family<span class="token punctuation">.</span>desc
        <span class="token punctuation">}</span>
        list<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span>
        <span class="token keyword">return</span> list
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
      pretectionList <span class="token operator">=</span> result<span class="token punctuation">.</span>pretectionList<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">list<span class="token punctuation">,</span> pretection</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> item <span class="token operator">=</span> <span class="token punctuation">{</span>
          name<span class="token operator">:</span> pretection<span class="token punctuation">.</span>name<span class="token punctuation">,</span>
          desc<span class="token operator">:</span> pretection<span class="token punctuation">.</span>desc<span class="token punctuation">,</span>
          ship<span class="token operator">:</span> pretection<span class="token punctuation">.</span>ship
        <span class="token punctuation">}</span>
        list<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span>
        <span class="token keyword">return</span> list
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// 在B页面中</span>
<span class="token keyword">let</span> homeList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">let</span> inviteList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">function</span> <span class="token function">initListData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">requestHomeList</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      familyList <span class="token operator">=</span> result<span class="token punctuation">.</span>homeList<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">list<span class="token punctuation">,</span> home</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> item <span class="token operator">=</span> <span class="token punctuation">{</span>
          name<span class="token operator">:</span> home<span class="token punctuation">.</span>name<span class="token punctuation">,</span>
          desc<span class="token operator">:</span> family<span class="token punctuation">.</span>desc
        <span class="token punctuation">}</span>
        list<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span>
        <span class="token keyword">return</span> list
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
      pretectionList <span class="token operator">=</span> result<span class="token punctuation">.</span>inviteList<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">list<span class="token punctuation">,</span> invite</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> item <span class="token operator">=</span> <span class="token punctuation">{</span>
          name<span class="token operator">:</span> invite<span class="token punctuation">.</span>name<span class="token punctuation">,</span>
          desc<span class="token operator">:</span> invite<span class="token punctuation">.</span>desc<span class="token punctuation">,</span>
          ship<span class="token operator">:</span> invite<span class="token punctuation">.</span>ship
        <span class="token punctuation">}</span>
        list<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span>
        <span class="token keyword">return</span> list
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这样一看是没什么问题，但是感觉写了很多重复性的内容，我们就可以对这段代码做一个小小的优化</p> <p>先抽取处理<code>list</code>的函数</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">handleList</span><span class="token punctuation">(</span><span class="token parameter">list<span class="token punctuation">,</span> aimsArray</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> copyList <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> copyList<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">list<span class="token punctuation">,</span> cur</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> item <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    aimsArray<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">key</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        item<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> cur<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    list<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span>
    <span class="token keyword">return</span> list
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在定义两个字段数组</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> aims <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'desc'</span><span class="token punctuation">]</span>
<span class="token keyword">const</span> aimsWithShip <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>aims<span class="token punctuation">,</span> <span class="token string">'ship'</span><span class="token punctuation">]</span>
</code></pre></div><p>然后我们对代码修改一下:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 在A页面中</span>
<span class="token keyword">let</span> familyList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">let</span> pretectionList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">function</span> <span class="token function">initListData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">requestFamilyList</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> 
      familyList <span class="token operator">=</span> <span class="token function">handleList</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>familyList<span class="token punctuation">,</span> aims<span class="token punctuation">)</span>
      pretectionList <span class="token operator">=</span> <span class="token function">handleList</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>pretectionList<span class="token punctuation">,</span> aimsWithShip<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// 在B页面中</span>
<span class="token keyword">let</span> homeList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">let</span> inviteList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">function</span> <span class="token function">initListData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">requestHomeList</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      familyList <span class="token operator">=</span> <span class="token function">handleList</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>homeList<span class="token punctuation">,</span> aims<span class="token punctuation">)</span>
      pretectionList <span class="token operator">=</span> <span class="token function">handleList</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>inviteList<span class="token punctuation">,</span> aimsWithShip<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这样一看是不是清爽很多，而且如果以后在遇见类似的我们只需要使用<code>handleList</code>这个函数处理就可以了,当然这只是比较简单的处理，即使每个数组中取的字段都不一样，也可以用同样的方式进行处理</p> <h2 id="函数是一等公民"><a href="#函数是一等公民" class="header-anchor">#</a> 函数是一等公民</h2> <p>在<code>javascript</code>中，<strong>函数是一个普通的对象</strong>,所以它具有以下几个特点：</p> <ul><li>函数可以存储在变量中</li> <li>函数可以作为参数</li> <li>函数可以作为返回值</li></ul> <h3 id="函数可以存储在变量中"><a href="#函数可以存储在变量中" class="header-anchor">#</a> 函数可以存储在变量中</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 简单例子</span>
<span class="token keyword">const</span> <span class="token function-variable function">fn</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Hello First-class Function'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 案例</span>
<span class="token keyword">const</span> LoginController <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token function">login</span><span class="token punctuation">(</span><span class="token parameter">payload</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> Login<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">logout</span><span class="token punctuation">(</span><span class="token parameter">payload</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> Login<span class="token punctuation">.</span><span class="token function">logout</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// 优化</span>
<span class="token keyword">const</span> LoginController <span class="token operator">=</span> <span class="token punctuation">{</span>
    login<span class="token operator">:</span> Login<span class="token punctuation">.</span>login<span class="token punctuation">,</span>
    logout<span class="token operator">:</span> Login<span class="token punctuation">.</span>logout
<span class="token punctuation">}</span>
</code></pre></div><h3 id="函数可以作为参数"><a href="#函数可以作为参数" class="header-anchor">#</a> 函数可以作为参数</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">sortFunc</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> a <span class="token operator">-</span> b
<span class="token punctuation">}</span>
<span class="token keyword">let</span> array <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">]</span>
<span class="token comment">// 对数组进行排序</span>
array<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span>sortFunc<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>array<span class="token punctuation">)</span> <span class="token comment">//  [1, 2, 3, 4, 4, 5, 8, 9]</span>
</code></pre></div><h3 id="函数可以作为返回值"><a href="#函数可以作为返回值" class="header-anchor">#</a> 函数可以作为返回值</h3> <p>常见的有很多，举个开发中的例子吧</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 请求接口数据</span>
<span class="token keyword">function</span> <span class="token function">requestData</span><span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">payload</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">request</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> payload<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// 比如想要请求一个列表</span>
<span class="token keyword">const</span> getList <span class="token operator">=</span> <span class="token function">requestData</span><span class="token punctuation">(</span><span class="token string">&quot;/api/recordList&quot;</span><span class="token punctuation">)</span>
<span class="token comment">// 调用的时候</span>
<span class="token function">getList</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    pageIndex<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    pageSize<span class="token operator">:</span> <span class="token number">10</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="高阶函数"><a href="#高阶函数" class="header-anchor">#</a> 高阶函数</h2> <p>在上面的例子中我们其实已经简单的使用了高阶函数，下面进行详细的介绍</p> <p>高阶函数(Higer-order function)</p> <ul><li>可以把函数作为参数传递给另一个函数</li> <li>可以把函数作为另一个函数的返回结果</li></ul> <h3 id="可以把函数作为参数"><a href="#可以把函数作为参数" class="header-anchor">#</a> 可以把函数作为参数</h3> <p>我们知道<code>js</code>中数组的很多方法都是使用函数作为参数的，比如说<code>forEach</code>，<code>map</code>，<code>filter</code>等等，我们模拟其中的几个实现</p> <h4 id="foreach实现"><a href="#foreach实现" class="header-anchor">#</a> forEach实现</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// forEach</span>
<span class="token keyword">function</span> <span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">array<span class="token punctuation">,</span> fn</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> len <span class="token operator">=</span> array<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">fn</span><span class="token punctuation">(</span>array<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// test</span>
<span class="token keyword">let</span> array <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span>
<span class="token function">forEach</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 1 2 4 6</span>
</code></pre></div><h4 id="filter实现"><a href="#filter实现" class="header-anchor">#</a> filter实现</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">array<span class="token punctuation">,</span> fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> results <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> len <span class="token operator">=</span> array<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">fn</span><span class="token punctuation">(</span>array<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            results<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>array<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> results
<span class="token punctuation">}</span>
<span class="token comment">// test</span>
<span class="token keyword">let</span> array <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span>
<span class="token keyword">let</span> ret <span class="token operator">=</span> <span class="token function">filter</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> item <span class="token operator">&gt;</span> <span class="token number">2</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>ret<span class="token punctuation">)</span> <span class="token comment">// [4, 6]</span>
</code></pre></div><h3 id="可以把函数作为返回结果"><a href="#可以把函数作为返回结果" class="header-anchor">#</a> 可以把函数作为返回结果</h3> <p>先举个小例子</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">makeFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> msg <span class="token operator">=</span> <span class="token string">&quot;Hello function&quot;</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// test</span>
<span class="token keyword">let</span> fn <span class="token operator">=</span> <span class="token function">makeFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// Hello function</span>
</code></pre></div><p>在平常开发过程中，<code>once</code>函数大家应该不陌生，就是函数只会被执行一次，那么是怎么实现的呢？我们可以来模拟一下</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">once</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> done <span class="token operator">=</span> <span class="token boolean">false</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>done<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            done <span class="token operator">=</span> <span class="token boolean">true</span>
            <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>fn<span class="token punctuation">,</span> arguments<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// test</span>
<span class="token keyword">let</span> fn <span class="token operator">=</span> <span class="token function">once</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">num</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token function">fn</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
<span class="token function">fn</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
<span class="token function">fn</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token comment">// 只会打印一次5</span>
</code></pre></div><p>可以看到，只有当<code>once</code>函数内部的<code>done</code>变量为<code>false</code>的时候，<code>fn</code>函数才会被执行,并且<code>done</code>会被修改为<code>true</code>，那么后边不管调用多少次，<code>fn</code>都不会被执行了。</p> <h3 id="高级函数的意义"><a href="#高级函数的意义" class="header-anchor">#</a> 高级函数的意义</h3> <ul><li>抽象可以帮我们屏蔽细节，只需要关注我们的目标</li> <li>高阶函数用来抽象通用的问题</li></ul> <h3 id="常用的高阶函数"><a href="#常用的高阶函数" class="header-anchor">#</a> 常用的高阶函数</h3> <ul><li>forEach</li> <li>map</li> <li>filter</li> <li>every</li> <li>some</li> <li>find/findIndex</li> <li>reduce</li> <li>sort</li> <li>....</li></ul> <p>我们模拟其中的几个的实现</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// map</span>
<span class="token keyword">function</span> <span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">array<span class="token punctuation">,</span> fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> results <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> len <span class="token operator">=</span> array<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        results<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token function">fn</span><span class="token punctuation">(</span>array<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> results
<span class="token punctuation">}</span>
<span class="token comment">// test</span>
<span class="token keyword">let</span> array <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span>
<span class="token keyword">let</span> ret <span class="token operator">=</span> <span class="token function">map</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span> <span class="token parameter">v</span> <span class="token operator">=&gt;</span> v <span class="token operator">*</span> v<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>ret<span class="token punctuation">)</span> <span class="token comment">// [1, 4, 9]</span>
<span class="token comment">// every</span>
<span class="token keyword">function</span> <span class="token function">every</span><span class="token punctuation">(</span><span class="token parameter">array<span class="token punctuation">,</span> fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> flag <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> len <span class="token operator">=</span> array<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        flag <span class="token operator">=</span> <span class="token function">fn</span><span class="token punctuation">(</span>array<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>flag<span class="token punctuation">)</span> <span class="token punctuation">{</span>
           	<span class="token keyword">break</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> flag
<span class="token punctuation">}</span>
<span class="token comment">// test</span>
<span class="token keyword">let</span> array <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>
<span class="token keyword">let</span> b <span class="token operator">=</span> <span class="token function">every</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span> <span class="token parameter">v</span> <span class="token operator">=&gt;</span> v <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span> <span class="token comment">// false</span>
<span class="token keyword">let</span> b2 <span class="token operator">=</span> <span class="token function">every</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span> <span class="token parameter">v</span> <span class="token operator">=&gt;</span> v <span class="token operator">&gt;=</span> <span class="token number">1</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b2<span class="token punctuation">)</span> <span class="token comment">// true</span>

<span class="token comment">// some</span>
<span class="token keyword">function</span> <span class="token function">some</span><span class="token punctuation">(</span><span class="token parameter">array<span class="token punctuation">,</span> fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> flag <span class="token operator">=</span> <span class="token boolean">false</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> len <span class="token operator">=</span> array<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        flag <span class="token operator">=</span> <span class="token function">fn</span><span class="token punctuation">(</span>array<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>flag<span class="token punctuation">)</span> <span class="token punctuation">{</span>
           	<span class="token keyword">break</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> flag
<span class="token punctuation">}</span>
<span class="token comment">// test</span>
<span class="token keyword">let</span> array <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>
<span class="token keyword">let</span> b <span class="token operator">=</span> <span class="token function">some</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span> <span class="token parameter">v</span> <span class="token operator">=&gt;</span> v <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span> <span class="token comment">// true</span>
<span class="token keyword">let</span> b2 <span class="token operator">=</span> <span class="token function">some</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span> <span class="token parameter">v</span> <span class="token operator">=&gt;</span> v <span class="token operator">&gt;=</span> <span class="token number">4</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b2<span class="token punctuation">)</span> <span class="token comment">// false</span>

<span class="token comment">// reduce</span>
<span class="token comment">// reduce函数有一点点不一样，因为它可以传递一个初始值，所以需要处理一下</span>
<span class="token keyword">function</span> <span class="token function">reduce</span><span class="token punctuation">(</span><span class="token parameter">array<span class="token punctuation">,</span> fn<span class="token punctuation">,</span> initialValue</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 判断是否有初始值</span>
    <span class="token keyword">let</span> hasInitialValue <span class="token operator">=</span> initialValue <span class="token operator">!==</span> <span class="token keyword">undefined</span>
    <span class="token comment">// 如果没有初始值，把数组的第一个元素作为初始值</span>
    <span class="token keyword">let</span> value <span class="token operator">=</span> hasInitialValue <span class="token operator">?</span> initialValue <span class="token operator">:</span> array<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    <span class="token comment">// 如果没有初始值，从1开始，有初始值，从0开始</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> hasInitialValue <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> array<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> el <span class="token operator">=</span> array<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
        value <span class="token operator">=</span> <span class="token function">fn</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> el<span class="token punctuation">,</span> i<span class="token punctuation">,</span> array<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> value
<span class="token punctuation">}</span>
<span class="token comment">// test</span>
<span class="token keyword">let</span> array <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span>
<span class="token comment">// 传递初始值</span>
<span class="token keyword">let</span> r <span class="token operator">=</span> <span class="token function">reduce</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">list<span class="token punctuation">,</span> cur</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    list<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>cur <span class="token operator">*</span> cur<span class="token punctuation">)</span>
    <span class="token keyword">return</span> list
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span> <span class="token comment">// [1, 4, 9, 16]</span>
<span class="token comment">// 不传递初始值</span>
<span class="token keyword">let</span> maxNum <span class="token operator">=</span> <span class="token function">reduce</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">pre<span class="token punctuation">,</span> cur</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> pre <span class="token operator">&lt;</span> cur <span class="token operator">?</span> cur <span class="token operator">:</span> pre<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>maxNum<span class="token punctuation">)</span> <span class="token comment">// 4</span>
</code></pre></div><h2 id="闭包"><a href="#闭包" class="header-anchor">#</a> 闭包</h2> <h3 id="概念-2"><a href="#概念-2" class="header-anchor">#</a> 概念</h3> <p>函数和其周围的状态（词法环境的引用捆绑在一起形成闭包）</p> <ul><li>可以在另外一个作用域中调用一个函数的内部函数并访问到该函数的作用域中的成员</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">makeFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> msg <span class="token operator">=</span> <span class="token string">&quot;Hello function&quot;</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// 在makeFn执行完毕后，msg这个成员应该会被释放，但是由于闭包的存在，它并没有被释放，所以在fn执行的时候依然可以访问到msg这个成员</span>
<span class="token keyword">const</span> fn <span class="token operator">=</span> <span class="token function">makeFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// 在和makeFn相同作用域中调用了makeFn内部的函数，makeFn内部的函数访问了makeFn中的变量成员msg</span>
<span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// Hello function</span>
</code></pre></div><p>看看上面提到的开发中接口请求这个列子</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 请求接口数据</span>
<span class="token keyword">function</span> <span class="token function">requestData</span><span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">payload</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">request</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> payload<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// 执行完requestData这个函数的时候，url这个应该会被释放掉，但是内部的匿名函数又使用了url这个参数，形成了闭包，所以它并不会被释放</span>
<span class="token keyword">const</span> getList <span class="token operator">=</span> <span class="token function">requestData</span><span class="token punctuation">(</span><span class="token string">&quot;/api/recordList&quot;</span><span class="token punctuation">)</span>
<span class="token comment">// 调用的时候我们就不需要再次传递url这个参数，因为它在上次执行的时候被保存在内存中并没有被释放掉，所以我们调用requestData中的函数的时候并不需要再次传递这个参数</span>
<span class="token function">getList</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    pageIndex<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    pageSize<span class="token operator">:</span> <span class="token number">10</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>闭包的本质：函数在执行的时候会放到一个执行栈上当函数执行完毕之后会从执行栈上移除，但是<strong>堆上的作用域成员因为被外部引用不能释放</strong>，因此内部函数依然可以访问外部函数的成员</li></ul> <h3 id="案例"><a href="#案例" class="header-anchor">#</a> 案例</h3> <h4 id="求数字的幂次方"><a href="#求数字的幂次方" class="header-anchor">#</a> 求数字的幂次方</h4> <p>在开发过程中，有时候我们会去求一个数字的2次方或者3次方</p> <p>我们可能会这么去写</p> <div class="language-js extra-class"><pre class="language-js"><code>Math<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
Math<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
Math<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
Math<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
</code></pre></div><p>可以看到，那个幂次2和3如果有多次调用的话，其实是重复的</p> <p>所以我们可以这样来改写一下</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 生成幂次方的函数</span>
<span class="token keyword">function</span> <span class="token function">makePower</span><span class="token punctuation">(</span><span class="token parameter">power</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> Math<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span>number<span class="token punctuation">,</span> power<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// 求2次方的函数</span>
<span class="token keyword">let</span> power2 <span class="token operator">=</span> <span class="token function">makePower</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token comment">// 求3次方的函数</span>
<span class="token keyword">let</span> power3 <span class="token operator">=</span> <span class="token function">makePower</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
<span class="token comment">// 调用</span>
<span class="token function">power2</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>
<span class="token function">power2</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
<span class="token function">power3</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span>
<span class="token function">power3</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span>

</code></pre></div><p>可以看到，在调用的时候就不需要在传递是几次方了，直接使用生成的求几次方的函数就好了</p> <p>在浏览器中打开开发中工具中的<code>Sources</code>，我们可以看到代码执行情况、作用域情况以及闭包情况</p> <img src="/blog/img/run.jpg" alt="queue" class="custom"> <h4 id="求员工的工资"><a href="#求员工的工资" class="header-anchor">#</a> 求员工的工资</h4> <p>一个员工的工资应该由基本工资和绩效工资组成，不同的员工有不同的级别，每个级别的基本工资是不一样的，同一级别的基本工资是相同的，这种情况下，我们可以这样来写</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">makeSalary</span><span class="token punctuation">(</span><span class="token parameter">base</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">performance</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> base <span class="token operator">+</span> performance
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// 假设级别一的基本工资为12000，级别二的工资为15000</span>
<span class="token comment">// 级别为一的员工工资计算</span>
<span class="token keyword">let</span> level1 <span class="token operator">=</span> <span class="token function">makeSalary</span><span class="token punctuation">(</span><span class="token number">12000</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> level2 <span class="token operator">=</span> <span class="token function">makeSalary</span><span class="token punctuation">(</span><span class="token number">15000</span><span class="token punctuation">)</span>
<span class="token comment">// 在调用的时候只需要传递绩效工资就可以了</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">level1</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">level2</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

</code></pre></div><h4 id="数据缓存"><a href="#数据缓存" class="header-anchor">#</a> 数据缓存</h4> <p>假设我们要求得某一个值，但是这个值的计算非常耗时，我们就可以通过闭包来提高这个性能，只需要第一记性计算，以后再次取值，直接从缓存中获取</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">executor</span><span class="token punctuation">(</span><span class="token parameter">arim</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 计算耗时1分钟</span>
    <span class="token keyword">return</span> arim
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">getValue</span> <span class="token punctuation">(</span><span class="token parameter">executor</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> cache <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> key <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span>
        cache<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> cache<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token function">executor</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>executor<span class="token punctuation">,</span> arguments<span class="token punctuation">)</span>
        <span class="token keyword">return</span> cache<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><h2 id="纯函数"><a href="#纯函数" class="header-anchor">#</a> 纯函数</h2> <h3 id="概念-3"><a href="#概念-3" class="header-anchor">#</a> 概念</h3> <ul><li><p>纯函数：<strong>相同的输入永远会得到相同的输出</strong>，而且没有任何可观察的副作用</p> <ul><li><p>纯函数就类似数学中的函数（用来描述输入和输出之间的关系）, <code>y=sin(x)</code></p></li> <li><p><code>lodash</code>是一个纯函数的功能库，提供了对数组，数字，对象，字符串，函数等操作的一些方法</p></li> <li><p>数组的<code>slice</code>是纯函数，<code>splice</code>是不纯的函数</p> <ul><li><code>slice</code>返回数组中指定的部分，不改变原数组</li> <li><code>splice</code>对数组操作返回该数组，会改变原数组</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> numberArray <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span>
<span class="token comment">// slice</span>
numberArray<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token comment">// =&gt; [1, 2, 3]</span>
numberArray<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token comment">// =&gt; [1, 2, 3]</span>
numberArray<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token comment">// =&gt; [1, 2, 3]</span>


<span class="token comment">// splice</span>
numberArray<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token comment">// =&gt; [1, 2, 3]</span>
numberArray<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token comment">// =&gt; [4, 5]</span>
numberArray<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token comment">// =&gt; []</span>

</code></pre></div></li></ul></li> <li><p>函数式编程不会保留计算中间的结果，所有变量是不可变的（无状态的）</p></li> <li><p>我们可以把一个函数的执行结果交给另一个函数去处理</p></li></ul> <h3 id="lodash"><a href="#lodash" class="header-anchor">#</a> lodash</h3> <p><a href="https://www.lodashjs.com/" target="_blank" rel="noopener noreferrer">lodash官网<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>它是一个一致性、模块化、高性能的 JavaScript 实用工具库。</p> <p>介绍几个常用的方法</p> <p><code>first</code>，<code>last</code>，<code>toUpper</code>，<code>reverse</code>，<code>each</code>，<code>includes</code>，·<code>find</code>，<code>findIndex</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> _ <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'lodash'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> array <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'tom'</span><span class="token punctuation">,</span> <span class="token string">'jock'</span><span class="token punctuation">,</span> <span class="token string">'lucy'</span><span class="token punctuation">,</span> <span class="token string">'kuli'</span><span class="token punctuation">]</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>_<span class="token punctuation">.</span><span class="token function">first</span><span class="token punctuation">(</span>array<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// =&gt; tom</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>_<span class="token punctuation">.</span><span class="token function">last</span><span class="token punctuation">(</span>array<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// =&gt; kuli</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>_<span class="token punctuation">.</span><span class="token function">toUpper</span><span class="token punctuation">(</span>_<span class="token punctuation">.</span><span class="token function">first</span><span class="token punctuation">(</span>array<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// =&gt; TOM</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>_<span class="token punctuation">.</span><span class="token function">reverse</span><span class="token punctuation">(</span>array<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// ['kuli', 'lucy', 'jock', 'tom']</span>

</code></pre></div><p>可以看到<code>lodash</code>的使用非常简单，具体可以看<code>lodash</code>官网</p> <h3 id="优点-2"><a href="#优点-2" class="header-anchor">#</a> 优点</h3> <h4 id="可缓存"><a href="#可缓存" class="header-anchor">#</a> 可缓存</h4> <p>因为纯函数对相同的输入始终有相同的输出，所以可以把纯函数的结果缓存起来</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> _ <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'lodash'</span><span class="token punctuation">)</span>
<span class="token keyword">function</span> <span class="token function">getArea</span> <span class="token punctuation">(</span><span class="token parameter">r</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> r <span class="token operator">*</span> r
<span class="token punctuation">}</span>
<span class="token keyword">let</span> getAreaWithMemory <span class="token operator">=</span> _<span class="token punctuation">.</span><span class="token function">memoize</span><span class="token punctuation">(</span>getArea<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">getAreaWithMemory</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

</code></pre></div><p>我们可以来模拟一下<code>memoize</code>的实现</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">memoize</span> <span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> cache <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> key <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span>
        cache<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> cache<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>fn<span class="token punctuation">,</span> arguments<span class="token punctuation">)</span>
        <span class="token keyword">return</span> cache<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// test</span>
<span class="token keyword">let</span> getAreaWithMemory <span class="token operator">=</span> <span class="token function">memoize</span><span class="token punctuation">(</span>getArea<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">getAreaWithMemory</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

</code></pre></div><h4 id="可测试"><a href="#可测试" class="header-anchor">#</a> 可测试</h4> <p>因为纯函数对相同的输入始终有相同的输出，所以纯函数让测试更方便</p> <h4 id="并行处理"><a href="#并行处理" class="header-anchor">#</a> 并行处理</h4> <ul><li>在多线程环境下并行操作共享的内存数据很可能会出现意外情况</li> <li>纯函数不需要访问共享的内存数据，所以在并行环境下可以任意运行纯函数（Web Worker）</li></ul> <h2 id="副作用"><a href="#副作用" class="header-anchor">#</a> 副作用</h2> <h3 id="概念-4"><a href="#概念-4" class="header-anchor">#</a> 概念</h3> <p>副作用让一个函数变的不纯，纯函数对相同的输入始终有相同的输出，如果函数依赖于外部的状态就无法保证输出相同就会带来副作用</p> <p>举个简单的例子</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 不纯的</span>
<span class="token keyword">const</span> authArray <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'manager'</span><span class="token punctuation">,</span> <span class="token string">'user'</span><span class="token punctuation">]</span>
<span class="token keyword">function</span> <span class="token function">checkAuth</span> <span class="token punctuation">(</span><span class="token parameter">auth</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> authArray<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>auth<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// 该函数依赖于外部的authArray,如果authArray变化后，那么这个函数对于相同的输入就无法保证会有相同的输出，所以是不纯的函数</span>
<span class="token comment">// 改变成纯函数</span>
<span class="token keyword">function</span> <span class="token function">checkAuth</span> <span class="token punctuation">(</span><span class="token parameter">auth<span class="token punctuation">,</span> authArray</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> authArray<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>auth<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre></div><h3 id="来源"><a href="#来源" class="header-anchor">#</a> 来源</h3> <ul><li>配置文件</li> <li>数据库</li> <li>获取用户的输入</li> <li>...</li></ul> <p>所有的外部交互都有可能代理副作用，副作用也使得方法通用性下降不适合扩展和可重用性同时副作用会给程序中带来安全隐患给程序带来不确定性，但是副作用不可能完全禁止尽可能控制他们在可控范围内发生。</p> <h2 id="柯里化"><a href="#柯里化" class="header-anchor">#</a> 柯里化</h2> <p>我们用上面例子中的<code>checkAuth</code>函数来做个小例子</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">checkAuth</span> <span class="token punctuation">(</span><span class="token parameter">auth<span class="token punctuation">,</span> authArray</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> authArray<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>auth<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// 调用</span>
<span class="token keyword">const</span> authArray <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'manager'</span><span class="token punctuation">,</span> <span class="token string">'user'</span><span class="token punctuation">]</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">checkAuth</span><span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">,</span> authArray<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">checkAuth</span><span class="token punctuation">(</span><span class="token string">'manager'</span><span class="token punctuation">,</span> authArray<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// true</span>

</code></pre></div><p>我们可以看到在调用的时候，<code>authArray</code>这个参数还是被重复的传递了，我们做一个小小的修改</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 柯里化</span>
<span class="token keyword">function</span> <span class="token function">checkAuth</span> <span class="token punctuation">(</span><span class="token parameter">authArray</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">auth</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> authArray<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>auth<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// 也可以使用es6的箭头函数来书写</span>
<span class="token keyword">const</span> <span class="token function-variable function">checkAuth2</span> <span class="token operator">=</span> <span class="token parameter">authArray</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token parameter">auth</span> <span class="token operator">=&gt;</span> authArray<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>auth<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> authArray <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'manager'</span><span class="token punctuation">,</span> <span class="token string">'user'</span><span class="token punctuation">]</span>
<span class="token keyword">const</span> roleAuthArray <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'role'</span><span class="token punctuation">,</span> <span class="token string">'roleManager'</span><span class="token punctuation">]</span>
<span class="token keyword">let</span> checkNormalAuth <span class="token operator">=</span> <span class="token function">checkAuth</span><span class="token punctuation">(</span>authArray<span class="token punctuation">)</span>
<span class="token keyword">let</span> checkRoleAuth <span class="token operator">=</span> <span class="token function">checkAuth</span><span class="token punctuation">(</span>roleAuthArray<span class="token punctuation">)</span>
<span class="token comment">// 调用</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">checkNormalAuth</span><span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// =&gt; true</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">checkNormalAuth</span><span class="token punctuation">(</span><span class="token string">'role'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// =&gt; false</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">checkRoleAuth</span><span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>   <span class="token comment">// =&gt; false</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">checkRoleAuth</span><span class="token punctuation">(</span><span class="token string">'role'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>   <span class="token comment">// =&gt; true</span>

</code></pre></div><p>这样每次只需要去调用固定的函数就好了，也不需要重复的传递参数</p> <h3 id="概念-5"><a href="#概念-5" class="header-anchor">#</a> 概念</h3> <p>把接受多个参数的函数变换成接受一个单一参数（最初函数的第一个参数）的函数，并且返回接受余下的参数而且返回结果的新函数</p> <h3 id="lodash中的柯里化函数curry"><a href="#lodash中的柯里化函数curry" class="header-anchor">#</a> lodash中的柯里化函数curry</h3> <p><code>lodash</code>中的柯里化函数是<code>curry</code></p> <ul><li>功能：创建一个函数，该函数接受一个或多个<code>func</code>的参数，如果<code>func</code>所需要的参数都被提供则执行<code>func</code>并返回执行的结果，否则继续返回该函数并等待接收剩余的参数</li> <li>参数：需要柯里化的函数</li> <li>返回值：柯里化后的函数</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> _ <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'lodash'</span><span class="token punctuation">)</span>
<span class="token comment">// 需要柯里化的函数</span>
<span class="token keyword">function</span> <span class="token function">add</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> a <span class="token operator">+</span> b <span class="token operator">+</span> c
<span class="token punctuation">}</span>
<span class="token keyword">const</span> getSum <span class="token operator">=</span> _<span class="token punctuation">.</span><span class="token function">curry</span><span class="token punctuation">(</span>add<span class="token punctuation">)</span>

<span class="token comment">// 使用</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">getSum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 6</span>
<span class="token comment">// 只传递部分参数</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">getSum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 6</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">getSum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 6</span>

</code></pre></div><h4 id="案例-2"><a href="#案例-2" class="header-anchor">#</a> 案例</h4> <p>我们如果需要判断一个字符串是否有空白字符，会这么去写<code>''.match(/\s+/g)</code></p> <p>判断字符串中是否有数字，<code>''.match(/\d+/g)</code></p> <p>我们先写一个纯函数</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">match</span> <span class="token punctuation">(</span><span class="token parameter">reg<span class="token punctuation">,</span> str</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> str<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>reg<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// 将这个函数柯里化</span>
<span class="token keyword">const</span> _ <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'lodash'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> match <span class="token operator">=</span> _<span class="token punctuation">.</span><span class="token function">curry</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">reg<span class="token punctuation">,</span> str</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> str<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>reg<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 判断是否有空白字符</span>
<span class="token keyword">const</span> hasSpace <span class="token operator">=</span> <span class="token function">match</span><span class="token punctuation">(</span><span class="token regex">/\s+/g</span><span class="token punctuation">)</span>
<span class="token comment">// 判断是否有数字</span>
<span class="token keyword">const</span> hasNumber <span class="token operator">=</span> <span class="token function">match</span><span class="token punctuation">(</span><span class="token regex">/\d+/g</span><span class="token punctuation">)</span>

<span class="token comment">// test</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">hasSpace</span><span class="token punctuation">(</span><span class="token string">&quot;hello world&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// =&gt; [' ']</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">hasSpace</span><span class="token punctuation">(</span><span class="token string">&quot;helloworld&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// =&gt; nunll</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">hasNumber</span><span class="token punctuation">(</span><span class="token string">&quot;123qwe&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// =&gt; ['123']</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">hasNumber</span><span class="token punctuation">(</span><span class="token string">&quot;qwe&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// =&gt; null</span>

</code></pre></div><p>如果我们要对一个数组中的空白字符进行过滤，我们可以使用数组<code>filter</code>方法来实现，可以先将数组<code>filter</code>方法做一层封装</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> filter <span class="token operator">=</span> _<span class="token punctuation">.</span><span class="token function">curry</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">func<span class="token punctuation">,</span> array</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> array<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 使用箭头函数来实现</span>
<span class="token keyword">const</span> filter2 <span class="token operator">=</span> _<span class="token punctuation">.</span><span class="token function">curry</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">func<span class="token punctuation">,</span> array</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> array<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// test</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">filter</span><span class="token punctuation">(</span>hasSpace<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'John Connor'</span><span class="token punctuation">,</span> <span class="token string">'Jack_milo'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// =&gt; [&quot;John Connor&quot;]</span>
<span class="token comment">// 因为可以传递多个参数，也可以只传递部分参数，所以我们可以利用这个特性来生成具有特定功能的函数</span>
<span class="token keyword">const</span> findSpace <span class="token operator">=</span> <span class="token function">filter</span><span class="token punctuation">(</span>hasSpace<span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">findSpace</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'John Connor'</span><span class="token punctuation">,</span> <span class="token string">'Jack_milo'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// =&gt; [&quot;John Connor&quot;]</span>

</code></pre></div><h4 id="curry实现"><a href="#curry实现" class="header-anchor">#</a> curry实现</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 首先curry这个函数需要接收一个函数作为参数</span>
<span class="token keyword">function</span> <span class="token function">curry</span> <span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// 两种调用方式</span>
<span class="token comment">// 1.当调用curry返回的函数时，如果传递的参数与传入curry的函数的参数个数一致，那么会立即返回该函数执行结果</span>
<span class="token comment">// 2.如果传递的参数是传入curry的函数的部分参数，那么会返回一个函数并等待其它参数</span>
<span class="token keyword">function</span> <span class="token function">curry</span> <span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">curriedFn</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 判断实参和形参的个数</span>
        <span class="token comment">// 如果传递参数个数小于形参的个数，返回一个函数</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>args<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> fn<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// 这个函数中的参数可以通过arguments来获取</span>
                <span class="token comment">// 将多次传入的参数合并成一个数组，然后展开传递</span>
                <span class="token comment">// arguments是一个类数组，需要使用Array.from来转换成一个数组</span>
                <span class="token keyword">return</span> <span class="token function">curriedFn</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 如果传递的参数个数大于等于形参个数，直接返回执行结果</span>
        <span class="token keyword">return</span> <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>fn<span class="token punctuation">,</span> args<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// test</span>
<span class="token keyword">function</span> <span class="token function">add</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> a <span class="token operator">+</span> b <span class="token operator">+</span> c
<span class="token punctuation">}</span>
<span class="token keyword">const</span> getSum <span class="token operator">=</span> <span class="token function">curry</span><span class="token punctuation">(</span>add<span class="token punctuation">)</span>

<span class="token comment">// 使用</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">getSum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 6</span>
<span class="token comment">// 只传递部分参数</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">getSum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 6</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">getSum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 6</span>

</code></pre></div><h3 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h3> <ul><li>柯里化可以让我们给一个函数传递较少的参数得到一个已经记住了某些固定参数的新函数</li> <li>这是一种对函数的缓存</li> <li>让函数变的更灵活，让函数的粒度更小</li> <li>可以把多元函数转换成一元函数，可以组合使用函数产生强大的功能</li></ul> <h2 id="函数组合"><a href="#函数组合" class="header-anchor">#</a> 函数组合</h2> <p>纯函数和柯里化很容易写出洋葱代码<code>h(g(f(x)))</code></p> <p>举个例子：获取数组中最后一个元素再转换成大写字母</p> <div class="language-js extra-class"><pre class="language-js"><code>_<span class="token punctuation">.</span><span class="token function">toUpper</span><span class="token punctuation">(</span>_<span class="token punctuation">.</span><span class="token function">first</span><span class="token punctuation">(</span>_<span class="token punctuation">.</span><span class="token function">reverse</span><span class="token punctuation">(</span>array<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

</code></pre></div><p>函数组合可以让我们把细粒度的函数重新组合生成一个新的函数</p> <h3 id="管道"><a href="#管道" class="header-anchor">#</a> 管道</h3> <p>下面这张图表示程序中使用函数处理数据的过程，给 fn 函数输入参数 a，返回结果 b。 a 数据通过一个管道得到了 b 数据。</p> <img src="/blog/img/grep.png" alt="queue" class="custom"> <p>当 fn 函数比较复杂的时候，我们可以把函数 fn 拆分成多个小函数，此时多了中间运算过程产生的 m和 n。
下面这张图中可以想象成把 fn 这个管道拆分成了3个管道 f1, f2, f3，数据 a 通过管道 f3 得到结果 m，m 再通过管道 f2 得到结果 n，n 通过管道 f1 得到最终结果 b</p> <img src="/blog/img/grep_mini.png" alt="queue" class="custom"> <div class="language-js extra-class"><pre class="language-js"><code>fn <span class="token operator">=</span> <span class="token function">compose</span><span class="token punctuation">(</span>f1<span class="token punctuation">,</span> f2<span class="token punctuation">,</span> f3<span class="token punctuation">)</span>
b <span class="token operator">=</span> <span class="token function">fn</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>

</code></pre></div><h3 id="函数组合-2"><a href="#函数组合-2" class="header-anchor">#</a> 函数组合</h3> <p>如果一个函数需要经过多个函数处理才能得到最终值这个时候可以把中间过程的函数合并成一个函数</p> <ul><li><p>函数就是数据管道，函数组合就是把这些管道连接起来，让数据穿过多个管道形成最终结果</p></li> <li><p><strong>函数组合默认是从右到左执行</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 举个简单的例子 求数组中的最后一个元素</span>
<span class="token comment">// 只是一个例子来说明</span>
<span class="token comment">// 定义一个组合函数</span>
<span class="token keyword">function</span> <span class="token function">compose</span> <span class="token punctuation">(</span><span class="token parameter">f1<span class="token punctuation">,</span> f2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token keyword">return</span> <span class="token function">f1</span><span class="token punctuation">(</span><span class="token function">f2</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">)</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">first</span> <span class="token punctuation">(</span><span class="token parameter">array</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token keyword">return</span> array<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">reverse</span> <span class="token punctuation">(</span><span class="token parameter">array</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token keyword">return</span> array<span class="token punctuation">.</span><span class="token function">reverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// 从右到左运行</span>
<span class="token keyword">let</span> last <span class="token operator">=</span> <span class="token function">compose</span><span class="token punctuation">(</span>first<span class="token punctuation">,</span> reverse<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">last</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// =&gt; 4</span>


</code></pre></div></li> <li><p>函数组合要满足<strong>结合律</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 结合律（associativity）</span>
<span class="token keyword">let</span> f <span class="token operator">=</span> <span class="token function">compose</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> g<span class="token punctuation">,</span> h<span class="token punctuation">)</span>
<span class="token keyword">let</span> associative <span class="token operator">=</span> <span class="token function">compose</span><span class="token punctuation">(</span><span class="token function">compose</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> g<span class="token punctuation">)</span><span class="token punctuation">,</span> h<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token function">compose</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> <span class="token function">compose</span><span class="token punctuation">(</span>g<span class="token punctuation">,</span> h<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// true</span>

</code></pre></div></li></ul> <p>所以代码也可以这样写</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> _ <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'lodash'</span><span class="token punctuation">)</span>
<span class="token comment">// const f = _.flowRight(_.toUpper, _.first, _.reverse)</span>
<span class="token comment">// const f = _.flowRight(_.flowRight(_.toUpper, _.first), _.reverse)</span>
<span class="token keyword">const</span> f <span class="token operator">=</span> _<span class="token punctuation">.</span><span class="token function">flowRight</span><span class="token punctuation">(</span>_<span class="token punctuation">.</span>toUpper<span class="token punctuation">,</span> _<span class="token punctuation">.</span><span class="token function">flowRight</span><span class="token punctuation">(</span>_<span class="token punctuation">.</span>first<span class="token punctuation">,</span> _<span class="token punctuation">.</span>reverse<span class="token punctuation">)</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'one'</span><span class="token punctuation">,</span> <span class="token string">'two'</span><span class="token punctuation">,</span> <span class="token string">'three'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

</code></pre></div><h3 id="lodash中的组合函数"><a href="#lodash中的组合函数" class="header-anchor">#</a> lodash中的组合函数</h3> <p><code>lodash</code>中的组合函数</p> <ul><li><code>lodash</code>中组合函数<code>flow()</code>或者<code>flowRight()</code>，都可以组合多个函数</li> <li><code>flow()</code>是从左到右运行</li> <li><code>flowRight</code>是从右到左运行，使用的多一些</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 举个简单的例子 求数组中的最后一个元素并且转换成大写</span>
<span class="token comment">// 只是一个例子来说明</span>
<span class="token keyword">const</span> _ <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'lodash'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token function-variable function">reverse</span> <span class="token operator">=</span> <span class="token parameter">arr</span> <span class="token operator">=&gt;</span> arr<span class="token punctuation">.</span><span class="token function">reverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token function-variable function">first</span> <span class="token operator">=</span> <span class="token parameter">arr</span> <span class="token operator">=&gt;</span> arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
<span class="token keyword">const</span> <span class="token function-variable function">toUpper</span> <span class="token operator">=</span> <span class="token parameter">s</span> <span class="token operator">=&gt;</span> s<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> f <span class="token operator">=</span> _<span class="token punctuation">.</span><span class="token function">flowRight</span><span class="token punctuation">(</span>toUpper<span class="token punctuation">,</span> first<span class="token punctuation">,</span> reverse<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'one'</span><span class="token punctuation">,</span> <span class="token string">'two'</span><span class="token punctuation">,</span> <span class="token string">'three'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// =&gt; THREE</span>

</code></pre></div><h3 id="lodash中flowright实现"><a href="#lodash中flowright实现" class="header-anchor">#</a> lodash中flowRight实现</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">compose</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 因为是从右开始执行，所以需要将传入的多个函数先进行反转</span>
        <span class="token keyword">return</span> args<span class="token punctuation">.</span><span class="token function">reverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res<span class="token punctuation">,</span> fn</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token function">fn</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// 使用箭头函数来书写</span>
<span class="token keyword">const</span> <span class="token function-variable function">compose</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token parameter">value</span> <span class="token operator">=&gt;</span> args<span class="token punctuation">.</span><span class="token function">reverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res<span class="token punctuation">,</span> fn</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">fn</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span>

<span class="token comment">// test</span>
<span class="token keyword">const</span> <span class="token function-variable function">reverse</span> <span class="token operator">=</span> <span class="token parameter">arr</span> <span class="token operator">=&gt;</span> arr<span class="token punctuation">.</span><span class="token function">reverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token function-variable function">first</span> <span class="token operator">=</span> <span class="token parameter">arr</span> <span class="token operator">=&gt;</span> arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
<span class="token keyword">const</span> <span class="token function-variable function">toUpper</span> <span class="token operator">=</span> <span class="token parameter">s</span> <span class="token operator">=&gt;</span> s<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> f <span class="token operator">=</span> <span class="token function">compose</span><span class="token punctuation">(</span>toUpper<span class="token punctuation">,</span> first<span class="token punctuation">,</span> reverse<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'one'</span><span class="token punctuation">,</span> <span class="token string">'two'</span><span class="token punctuation">,</span> <span class="token string">'three'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// =&gt; THREE</span>

</code></pre></div><h3 id="函数组合的调试"><a href="#函数组合的调试" class="header-anchor">#</a> 函数组合的调试</h3> <p>当函数组合了多个函数执行的时候，如果最后得到结果与我们的预期不一致，那么我们应该如何去查找是哪一个函数出了问题呢？</p> <p>我们可以顶一个<code>log</code>函数，加入到函数组合中去，去查看打印结果</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> _ <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'lodash'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> trace <span class="token operator">=</span> _<span class="token punctuation">.</span><span class="token function">curry</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">tag<span class="token punctuation">,</span> v</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>tag<span class="token punctuation">,</span> v<span class="token punctuation">)</span>
    <span class="token keyword">return</span> v
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> split <span class="token operator">=</span> _<span class="token punctuation">.</span><span class="token function">curry</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">sep<span class="token punctuation">,</span> str</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> _<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span> sep<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> join <span class="token operator">=</span> _<span class="token punctuation">.</span><span class="token function">curry</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">sep<span class="token punctuation">,</span> array</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> _<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span> sep<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> map <span class="token operator">=</span> _<span class="token punctuation">.</span><span class="token function">curry</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">fn<span class="token punctuation">,</span> array</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> _<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span> fn<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> f <span class="token operator">=</span> _<span class="token punctuation">.</span><span class="token function">flowRight</span><span class="token punctuation">(</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">trace</span><span class="token punctuation">(</span><span class="token string">'map 之后'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">map</span><span class="token punctuation">(</span>_<span class="token punctuation">.</span>toLower<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">trace</span><span class="token punctuation">(</span><span class="token string">'split 之后'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">split</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">f</span><span class="token punctuation">(</span><span class="token string">'NEVER SAY DIE'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// 打印结果</span>
<span class="token comment">// split 之后 [&quot;NEVER&quot;, &quot;SAY&quot;, &quot;DIE&quot;]</span>
<span class="token comment">// map 之后 [&quot;never&quot;, &quot;say&quot;, &quot;die&quot;]</span>
<span class="token comment">// never-say-die</span>

</code></pre></div><h3 id="lodash中的fp模块"><a href="#lodash中的fp模块" class="header-anchor">#</a> lodash中的fp模块</h3> <p><code>lodash</code>是<strong>数据优先，函数置后</strong>的特点，而<code>fp</code>模块是<strong>函数优先，数据置后</strong>的特点，与之相反</p> <p>我们可以利用这个特点对上面的代码进行改造</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> fp <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'lodash/fp'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> f <span class="token operator">=</span> fp<span class="token punctuation">.</span><span class="token function">flowRight</span><span class="token punctuation">(</span>fp<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> fp<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>_<span class="token punctuation">.</span>toLower<span class="token punctuation">)</span><span class="token punctuation">,</span> fp<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">f</span><span class="token punctuation">(</span><span class="token string">'NEVER SAY DIE'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// =&gt; never-say-die</span>

</code></pre></div><h2 id="point-free"><a href="#point-free" class="header-anchor">#</a> Point Free</h2> <h3 id="概念-6"><a href="#概念-6" class="header-anchor">#</a> 概念</h3> <p>把数据处理的过程定义成与数据无关的合成运算，不需要用到代表数据的那个参数，只要把简单的运算步骤合成到一起，在使用这种模式之前我们需要定义一些辅助的基本运算函数。</p> <ul><li>不需要指明处理的数据</li> <li><strong>只需要合成运算过程</strong></li> <li>需要定义一些辅助的基本运算函数</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> f <span class="token operator">=</span> fp<span class="token punctuation">.</span><span class="token function">flowRight</span><span class="token punctuation">(</span>fp<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> fp<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>_<span class="token punctuation">.</span>toLower<span class="token punctuation">)</span><span class="token punctuation">,</span> fp<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

</code></pre></div><p>这段代码中没有指明需要处理的数据，只是把一些运算过程进行了合成，最后返回了一个函数</p> <h3 id="案例-3"><a href="#案例-3" class="header-anchor">#</a> 案例</h3> <h4 id="将字符串转换成小写并用-连接"><a href="#将字符串转换成小写并用-连接" class="header-anchor">#</a> 将字符串转换成小写并用_连接</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Hello World =&gt; hello_world</span>
<span class="token comment">// 非Point Free 模式下</span>
<span class="token keyword">function</span> <span class="token function">trans</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> str<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/\s+/g</span><span class="token punctuation">,</span> <span class="token string">'_'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// Point Free模式</span>
<span class="token keyword">const</span> fp <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'lodash/fp'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> f <span class="token operator">=</span> fp<span class="token punctuation">.</span><span class="token function">flowRight</span><span class="token punctuation">(</span>fp<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/\s+/g</span><span class="token punctuation">,</span> <span class="token string">'_'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> fp<span class="token punctuation">.</span>toLower<span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">f</span><span class="token punctuation">(</span><span class="token string">'Hello World'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// hello_world</span>

</code></pre></div><h4 id="把单词中的首字母提取并转换成大写"><a href="#把单词中的首字母提取并转换成大写" class="header-anchor">#</a> 把单词中的首字母提取并转换成大写</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> fp <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'lodash/fp'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> f <span class="token operator">=</span> fp<span class="token punctuation">.</span><span class="token function">flowRight</span><span class="token punctuation">(</span>fp<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'. '</span><span class="token punctuation">)</span><span class="token punctuation">,</span> fp<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>fp<span class="token punctuation">.</span>first<span class="token punctuation">)</span><span class="token punctuation">,</span> fp<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>fp<span class="token punctuation">.</span>toUpper<span class="token punctuation">)</span><span class="token punctuation">,</span> fp<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">f</span><span class="token punctuation">(</span><span class="token string">'world wild web'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// =&gt; W. W. W</span>

</code></pre></div><p>上面的代码中<code>fp.map</code>调用了两次，做了两次循环，那么可不可以只调用一次呢？当然是可以的，我们可以先将<code>fp.first</code>和<code>fp.toUpper</code>组合在一起，然后再调用<code>map</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> f <span class="token operator">=</span> fp<span class="token punctuation">.</span><span class="token function">flowRight</span><span class="token punctuation">(</span>fp<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'. '</span><span class="token punctuation">)</span><span class="token punctuation">,</span> fp<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>fp<span class="token punctuation">.</span><span class="token function">flowRight</span><span class="token punctuation">(</span>fp<span class="token punctuation">.</span>first<span class="token punctuation">,</span> fp<span class="token punctuation">.</span>toUpper<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> fp<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

</code></pre></div><h2 id="functor（函子）"><a href="#functor（函子）" class="header-anchor">#</a> Functor（函子）</h2> <p>函数式编程中可以通过<strong>函子</strong>将副作用控制再可控的范围内，异常处理，异步操作等</p> <h3 id="概念-7"><a href="#概念-7" class="header-anchor">#</a> 概念</h3> <ul><li>容器：包含值和值的变形关系（变形关系即函数）</li> <li>函子：是一个特殊的容器，通过一个普通的对象来实现，该对象具有<code>map</code>方法，<code>map</code>方法可以运行一个函数对值进行处理（变形关系）</li></ul> <h3 id="functor-函子"><a href="#functor-函子" class="header-anchor">#</a> Functor 函子</h3> <p>函子是一个普通对象，里面维护一个值，对外有一个<code>map</code>方法，<code>map</code>方法会返回一个新的函子</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 基本函子</span>
<span class="token keyword">class</span> <span class="token class-name">Container</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_value <span class="token operator">=</span> x
  <span class="token punctuation">}</span>
  <span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Container</span><span class="token punctuation">(</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_value<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// test</span>
<span class="token keyword">let</span> r <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Container</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">x</span> <span class="token operator">=&gt;</span> x <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">x</span> <span class="token operator">=&gt;</span> x <span class="token operator">*</span> x<span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span> <span class="token comment">// =&gt; Container { _value: 36 }</span>

</code></pre></div><p>上面的代码中我们使用到了<code>new</code>，看起来很像面向对象，所以我们将它改造一下</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Container</span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> <span class="token keyword">of</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Container</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_value <span class="token operator">=</span> x
  <span class="token punctuation">}</span>
  <span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> Container<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_value<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// test</span>
<span class="token keyword">let</span> r <span class="token operator">=</span> Container<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">x</span> <span class="token operator">=&gt;</span> x <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">x</span> <span class="token operator">=&gt;</span> x <span class="token operator">*</span> x<span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span> <span class="token comment">// =&gt; Container { _value: 36 }</span>

</code></pre></div><p>函子永远不会对外公布它的值，想要处理这个值，就只能通过<code>map</code>方法</p> <h3 id="总结-2"><a href="#总结-2" class="header-anchor">#</a> 总结</h3> <ul><li>函数式编程的运算不直接操作值，而是由函子来完成</li> <li>函子就是一个实现了<code>map</code>锲约的对象</li> <li>我们可以把函子想象成一个盒子，这个盒子里封装了一个值</li> <li>想要处理盒子中的值，需要给盒子的<code>map</code>方法传递一个处理值的函数（纯函数），由这个函数对值进行处理</li> <li>最终<code>map</code>会返回一个包含新的值的函子</li></ul> <h3 id="maybe函子"><a href="#maybe函子" class="header-anchor">#</a> MayBe函子</h3> <p>上面的函子存在一个问题，就是当我们给函子传递的值为<code>null</code>或者<code>undefined</code>的时候，程序就会报错</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> r <span class="token operator">=</span> Container<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">x</span> <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

</code></pre></div><img src="/blog/img/error.png" alt="queue" class="custom"> <p>这种情况我们就可以使用<code>MayBe</code>函子来处理</p> <ul><li>我们在编程过程中可能会遇到很多错误，需要对这些错误做相应的处理</li> <li><code>MayBe</code>函子的作用就是可以对外部的空值情况做处理（控制副作用在允许的范围）</li></ul> <p><code>MayBe</code>函子的写法与上面的函子不同的是增加了一个判断值是不是<code>null</code>或者<code>undefined</code>方法，从而达到避免因为空值出现错误的情况</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">MayBe</span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> <span class="token keyword">of</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">MayBe</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_value <span class="token operator">=</span> value
  <span class="token punctuation">}</span>
  <span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 先判断值是否存在，如果不存在，创建一个值为null的函子，否则调用fn</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">isNothing</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">?</span> MayBe<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">:</span> MayBe<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_value<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">isNothing</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_value <span class="token operator">===</span> <span class="token keyword">null</span> <span class="token operator">||</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_value <span class="token operator">===</span> <span class="token keyword">undefined</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p>来测试一下</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// test</span>
<span class="token keyword">let</span> r <span class="token operator">=</span> MayBe<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">'hello world'</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">x</span> <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span>

<span class="token keyword">let</span> r2 <span class="token operator">=</span> MayBe<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">x</span> <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>r2<span class="token punctuation">)</span>

</code></pre></div><p>结果：</p> <img src="/blog/img/maybe.png" alt="queue" class="custom"> <p>可以看到当值为<code>null</code>的时候并不会报错，会返回一个值为<code>null</code> 的函子</p> <h3 id="either函子"><a href="#either函子" class="header-anchor">#</a> Either函子</h3> <p><code>MayBe</code>函子虽然可以解决空值的问题，但是也存在一个问题，我们看下面的代码</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 用上面的MayBe函子执行</span>
<span class="token keyword">let</span> r <span class="token operator">=</span> MayBe<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">'hello world'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">x</span> <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">x</span> <span class="token operator">=&gt;</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">x</span> <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span>

</code></pre></div><p>结果肯定是返回一个<code>null</code>值的<code>MayBe</code>函子，就与我们的预期不一致，那么我们调用了多次<code>map</code>方法，是在哪一次调用的时候出现了问题，我们是不知道的，所以我们就需要<code>Either</code>函子，它可以解决这个问题</p> <p><code>Either</code>函子的处理过程和<code>if-else</code>的处理过程类似</p> <ul><li><code>Either</code>两者中的任何一个，类似于<code>if...else...</code>的处理</li> <li>异常会让函数变的不纯，<code>Either</code>函子可以做异常处理</li></ul> <p>因为<code>Either</code>函子是两个中选择一个，所以我们需要定义两个函子<code>Left</code>和<code>Right</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Left</span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> <span class="token keyword">of</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Left</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_value <span class="token operator">=</span> value
  <span class="token punctuation">}</span>
  <span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Right</span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> <span class="token keyword">of</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Right</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_value <span class="token operator">=</span> value
  <span class="token punctuation">}</span>
  <span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> Right<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_value<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p>这里两个函子与上面的函子区别不大，只是<code>Left</code>这个函子返回的是<code>this</code>，它并没有去调用<code>fn</code>方法</p> <p>先做个小小的测试</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// test</span>
<span class="token keyword">let</span> r1 <span class="token operator">=</span> Right<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span> <span class="token parameter">x</span> <span class="token operator">=&gt;</span> x <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> r2 <span class="token operator">=</span> Left<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">x</span> <span class="token operator">=&gt;</span> x <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>r1<span class="token punctuation">)</span> <span class="token comment">// Right { _value: 7 }</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>r2<span class="token punctuation">)</span> <span class="token comment">// Left { _value: 5 }</span>

</code></pre></div><p>因为<code>Left</code>没有调用<code>fn</code>方法，所以值并不会发生改变</p> <p>但是为什么要这么做呢？</p> <p>我们来看下面一个小例子，把<code>JSON字符串</code>转换成<code>JSON</code>对象</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 先定一个转换函数</span>
<span class="token keyword">function</span> <span class="token function">parseJSON</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 因为在转换的过程中可能会出现错误，所以使用try-catch包裹起来</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token comment">// 正确情况下返回会执行fn的函子，Right函子</span>
    <span class="token keyword">return</span> Right<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 错误情况下我们可以把错误信息记录下来，返回不会执行fn的函子，这个函子的值就是错误信息，Left函子</span>
    <span class="token keyword">return</span> Left<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token punctuation">{</span> errorMsg<span class="token operator">:</span> e<span class="token punctuation">.</span>message<span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p>来测试一下</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> r1 <span class="token operator">=</span> <span class="token function">parseJSON</span><span class="token punctuation">(</span><span class="token string">'{name:zs}'</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>r1<span class="token punctuation">)</span>

<span class="token keyword">let</span> r2 <span class="token operator">=</span> <span class="token function">parseJSON</span><span class="token punctuation">(</span><span class="token string">'{&quot;name&quot;:&quot;zs&quot;}'</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>r2<span class="token punctuation">)</span>

<span class="token keyword">let</span> r3 <span class="token operator">=</span> <span class="token function">parseJSON</span><span class="token punctuation">(</span><span class="token string">'{&quot;name&quot;:&quot;zs&quot;}'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">x</span> <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span>name<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>r3<span class="token punctuation">)</span>

</code></pre></div><p>结果：</p> <img src="/blog/img/Either.png" alt="queue" class="custom"> <p>可以看到，程序不会报错，会返回一个带有错误信息的函子，正确情况下也是没问题的</p> <h3 id="io-函子"><a href="#io-函子" class="header-anchor">#</a> IO 函子</h3> <p>IO函子的特点</p> <ul><li>IO函子的值始终是一个函数，将函数当做值来处理</li> <li>IO函子可以将不纯的动作存到<code>_value</code>中，延迟执行不纯的动作（惰性执行）,包装当前操作的纯函数</li> <li>把不纯的动作交给调用者来处理</li></ul> <p>IO函子实现：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> fp <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'lodash/fp'</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">IO</span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> <span class="token keyword">of</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">IO</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> val
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_value <span class="token operator">=</span> fn
  <span class="token punctuation">}</span>
  <span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 把当前的 value 值和传入的 fn 合并成一个新的函数</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">IO</span><span class="token punctuation">(</span>fp<span class="token punctuation">.</span><span class="token function">flowRight</span><span class="token punctuation">(</span>fn<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_value<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p>接下来来调用一下他</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> r <span class="token operator">=</span> <span class="token constant">IO</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">x</span> <span class="token operator">=&gt;</span> x <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span> <span class="token comment">// IO { _value: [Function] }</span>

</code></pre></div><p>没错，IO函子里面的<code>_value</code>是一个函数，它不会返回给我们值，<code>map</code> 方法传入的函数可能是纯的也可能是不纯的，IO函子将这个动作保存起来，不会去执行这个函数，这样就保证了自己的操作是个纯的，将这个可能是不纯的动作交给调用者，这样函数的副作用就在可控范围内了，我们如果需要取这个值的话需要在调用一下<code>_value</code>这个函数</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> r <span class="token operator">=</span> <span class="token constant">IO</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">x</span> <span class="token operator">=&gt;</span> x <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token function">_value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 7</span>

</code></pre></div><h3 id="folktale-一个标准的函数式编程库"><a href="#folktale-一个标准的函数式编程库" class="header-anchor">#</a> folktale(一个标准的函数式编程库)</h3> <p><code>folktale</code>没有封装很多功能函数，它只提供了一些函数式处理的操作，<code>curry</code>，<code>compose</code>等，还有一些函子<code>Task</code>、<code>Either</code>、<code>MayBe</code>等</p> <p><a href="https://folktale.origamitower.com/docs/v2.3.0/" target="_blank" rel="noopener noreferrer">folktale官网<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>先来看一下基本使用</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> compose<span class="token punctuation">,</span> curry <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'folktale/core/lambda'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> first<span class="token punctuation">,</span> toUpper<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'lodash/fp'</span><span class="token punctuation">)</span>
<span class="token comment">// curry 2这个参数的意思是代表后面传入的函数有几个参数</span>
<span class="token keyword">let</span> f <span class="token operator">=</span> <span class="token function">curry</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> x <span class="token operator">+</span> y<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">f</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// =&gt; 3</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">f</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// =&gt; 3</span>
<span class="token comment">// compose</span>
<span class="token keyword">let</span> f2 <span class="token operator">=</span> <span class="token function">compose</span><span class="token punctuation">(</span>toUpper<span class="token punctuation">,</span> first<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">f2</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'one'</span><span class="token punctuation">,</span> <span class="token string">'two'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// ONE</span>

</code></pre></div><h3 id="folktale库中提供的task函子"><a href="#folktale库中提供的task函子" class="header-anchor">#</a> folktale库中提供的Task函子</h3> <p><a href="https://folktale.origamitower.com/api/v2.3.0/en/folktale.concurrency.task.html" target="_blank" rel="noopener noreferrer">Task函子官网地址<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>我们来做这样一个操作，将<code>package.json</code>文件中的<code>version</code>字段取出来，首先我们需要读取文件</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> task <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'folktale/concurrency/task'</span><span class="token punctuation">)</span>
<span class="token comment">// task会返回一个Task函子</span>
<span class="token comment">// 定义读取文件的方法,该方法返回一个Task函子</span>
<span class="token keyword">function</span> <span class="token function">readFile</span><span class="token punctuation">(</span><span class="token parameter">filename</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">task</span><span class="token punctuation">(</span><span class="token parameter">resolver</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> resolver<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
      resolver<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// 调用</span>
<span class="token comment">// 直接调用会返回一个Task函子，需要使用Task函子的run方法来执行读取文件这个操作</span>
<span class="token comment">// 可以通过listen方法来获取信息</span>
<span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'../package.json'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token function">onRejected</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">onResolved</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre></div><p>结果：</p> <img src="/blog/img/task.png" alt="queue" class="custom"> <p>在这里我们会获取到<code>package.json</code>文件中的所有内容，那么我们如果获取其中的<code>version</code>呢？</p> <p>我们知道，所有的函子都有一个<code>map</code>方法，我们可以先将整个<code>package.json</code>文件按照空格切割成数组，然后去寻找<code>version</code>就行了</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 引入 split find</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> split<span class="token punctuation">,</span> find <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'lodash/fp'</span><span class="token punctuation">)</span>

<span class="token comment">// 使用map方法做切割和查找</span>
<span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'../package.json'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">x</span> <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token parameter">x</span> <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'version'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token function">onRejected</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">onResolved</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">//  &quot;version&quot;: &quot;1.0.0&quot;,</span>

</code></pre></div><h3 id="pointed函子"><a href="#pointed函子" class="header-anchor">#</a> Pointed函子</h3> <p>这个函子其实我们一直在使用</p> <ul><li><code>Pointed</code>函子是实现了静态方法<code>of</code>的函子</li> <li><code>of</code>方法是为了避免使用<code>new</code>来创建对象，更深层的含义是 <code>of</code> 方法用来把值放到上下文<code>Context</code>（把值放到容器中，使用 <code>map</code> 来处理值）</li></ul> <h3 id="monad函子"><a href="#monad函子" class="header-anchor">#</a> Monad函子</h3> <p>在IO函子中存在一个问题，那就是函子嵌套的问题，举个例子，我们在<code>linux</code>有一个命令<code>cat</code>,它的作用是读取文件并打印出来，我们来模拟一下这个功能的实现</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> fp <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'lodash/fp'</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">IO</span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> <span class="token keyword">of</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">IO</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> x
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_value <span class="token operator">=</span> fn
  <span class="token punctuation">}</span>
  <span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">IO</span><span class="token punctuation">(</span>fp<span class="token punctuation">.</span><span class="token function">flowRight</span><span class="token punctuation">(</span>fn<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_value<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 定义读取文件的函数</span>
<span class="token keyword">function</span> <span class="token function">readFile</span><span class="token punctuation">(</span><span class="token parameter">filename</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">IO</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// 定义打印的函数</span>
<span class="token keyword">function</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">IO</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>
    <span class="token keyword">return</span> x
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 定义cat</span>
<span class="token keyword">const</span> cat <span class="token operator">=</span> fp<span class="token punctuation">.</span><span class="token function">flowRight</span><span class="token punctuation">(</span>print<span class="token punctuation">,</span> readFile<span class="token punctuation">)</span>

</code></pre></div><p>来使用一下</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// IO(IO(x))</span>
<span class="token keyword">let</span> r <span class="token operator">=</span> <span class="token function">cat</span><span class="token punctuation">(</span><span class="token string">'../package.json'</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span> <span class="token comment">// IO { _value: [Function] }</span>

</code></pre></div><p>这个返回结果<code>r</code>是什么呢？就是一个嵌套的函子</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> r <span class="token operator">=</span> <span class="token function">cat</span><span class="token punctuation">(</span><span class="token string">'../package.json'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">_value</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span> <span class="token comment">// IO { _value: [Function] }</span>

</code></pre></div><p>调用他的<code>_value</code>，返回的还是一个函子</p> <p>我们需要调用两次才能打印出文件的内容</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> r <span class="token operator">=</span> <span class="token function">cat</span><span class="token punctuation">(</span><span class="token string">'../package.json'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">_value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">_value</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span>
<span class="token comment">// {</span>
<span class="token comment">//   &quot;name&quot;: &quot;readme&quot;,</span>
<span class="token comment">//     &quot;version&quot;: &quot;1.0.0&quot;,</span>
<span class="token comment">//       &quot;description&quot;: &quot;folktale&quot;,</span>
<span class="token comment">//         &quot;main&quot;: &quot;index.js&quot;,</span>
<span class="token comment">//           &quot;scripts&quot;: {</span>
<span class="token comment">//     &quot;test&quot;: &quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span>
<span class="token comment">//   },</span>
<span class="token comment">//   &quot;keywords&quot;: [],</span>
<span class="token comment">//     &quot;author&quot;: &quot;&quot;,</span>
<span class="token comment">//       &quot;license&quot;: &quot;ISC&quot;,</span>
<span class="token comment">//         &quot;dependencies&quot;: {</span>
<span class="token comment">//     &quot;folktale&quot;: &quot;^2.3.2&quot;,</span>
<span class="token comment">//       &quot;lodash&quot;: &quot;^4.17.15&quot;</span>
<span class="token comment">//   }</span>
<span class="token comment">// }</span>

</code></pre></div><p>这种情况不是那么的方便，代码看起来也不够清爽，所有我们这个时候就可以使用<code>Monad</code>函子</p> <p>先介绍一下<code>Monad</code>函子，它是一个可以变扁的<code>Pointed</code>函子，就类似于数组扁平化一样将嵌套的函子排平</p> <ul><li>一个函子如果同时具有<code>join</code>和<code>of</code>两个方法并遵守一些定律就是一个<code>Monad</code>函子</li></ul> <p>我们对上面的IO函子改造一下，让它变成一个<code>Monad</code>函子</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> fp <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'lodash/fp'</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">IO</span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> <span class="token keyword">of</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">IO</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> x
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_value <span class="token operator">=</span> fn
  <span class="token punctuation">}</span>
  <span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">IO</span><span class="token punctuation">(</span>fp<span class="token punctuation">.</span><span class="token function">flowRight</span><span class="token punctuation">(</span>fn<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_value<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_value</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">flatMap</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// 在调用的时候</span>
<span class="token keyword">let</span> r <span class="token operator">=</span> <span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'../package.json'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">flatMap</span><span class="token punctuation">(</span>print<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span>

</code></pre></div><p>如果我们想把文件的内容转换成大写的，只需要加一个<code>map</code>就可以了</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> r <span class="token operator">=</span> <span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'../package.json'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>fp<span class="token punctuation">.</span>toUpper<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">flatMap</span><span class="token punctuation">(</span>print<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span>

</code></pre></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">更新时间:</span> <span class="time">2020年6月15日星期一晚上11点53分</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/note/EventLoop.html" class="prev">
        EventLoop
      </a></span> <span class="next"><a href="/blog/note/JS性能优化.html">
        JS性能优化
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/blog/assets/js/app.846c2af7.js" defer></script><script src="/blog/assets/js/2.7baf1e30.js" defer></script><script src="/blog/assets/js/18.3e102323.js" defer></script><script src="/blog/assets/js/3.e02a7905.js" defer></script>
  </body>
</html>
