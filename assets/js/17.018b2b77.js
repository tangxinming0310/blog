(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{376:function(t,s,a){"use strict";a.r(s);var n=a(27),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"前置知识（栈、队列的基本概念）"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#前置知识（栈、队列的基本概念）"}},[t._v("#")]),t._v(" 前置知识（栈、队列的基本概念）")]),t._v(" "),a("h3",{attrs:{id:"栈（stack）"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#栈（stack）"}},[t._v("#")]),t._v(" 栈（Stack）")]),t._v(" "),a("p",[a("strong",[t._v("栈")]),t._v("是一种先进后出的数据结构，先入栈的被压入栈低，最后入栈的数据在栈顶，出栈的时候从栈顶开始弹出数据（弹栈）")]),t._v(" "),a("h3",{attrs:{id:"队列（queue）"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#队列（queue）"}},[t._v("#")]),t._v(" 队列（Queue）")]),t._v(" "),a("p",[a("strong",[t._v("队列")]),t._v("是一种先进先出的数据结构，队列从一端入队，从另一端出队\n"),a("img",{staticClass:"custom",attrs:{src:t.$withBase("/queue.png"),alt:"queue"}})]),t._v(" "),a("h2",{attrs:{id:"同步任务与异步任务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#同步任务与异步任务"}},[t._v("#")]),t._v(" 同步任务与异步任务")]),t._v(" "),a("p",[t._v("js是单线程的，也就是说所有的任务都需要排队，前一个任务执行完毕，才会执行后一个任务，如果前一个任务耗时很长，那么后一个任务就需要一直等待，所以js的任务分为了"),a("code",[t._v("同步任务")]),t._v("和"),a("code",[t._v("异步任务")]),t._v("。")]),t._v(" "),a("ul",[a("li",[t._v("同步任务：调用立即得到结果的任务，同步任务是在主线程上排队执行的任务，只有前一个任务执行完毕，才会执行后一个任务。")]),t._v(" "),a("li",[t._v("异步任务：调用无法立即得到结果的任务，异步任务不进入主线程，而是进入"),a("code",[t._v("任务队列（task queue）")]),t._v("，只有当"),a("code",[t._v("任务队列")]),t._v("通知主线程，某个异步任务可以执行了，该任务才会进入主线程执行。\nJS引擎遇见异步任务（网络请求，setTimeout延时等），会交给某个线程单独去维护异步任务，等待某个时机（网络请求成功，延时结束等），然后由事件触发将异步任务的回调加入到"),a("code",[t._v("异步队列")]),t._v(","),a("code",[t._v("异步队列")]),t._v("中的回调函数等待被执行。")])]),t._v(" "),a("img",{staticClass:"custom",attrs:{src:t.$withBase("/loop.png"),alt:"loop"}}),t._v(" "),a("p",[t._v("举个例子：")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[t._v("console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'script start'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'timer 1 over'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'timer 2 over'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'script end'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// script start")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// script end")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// timer 2 over")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// timer 1 over")]),t._v("\n")])])]),a("p",[a("code",[t._v("timer 2 over")]),t._v("0毫秒后添加到任务队列队尾，"),a("code",[t._v("timer 1 over")]),t._v("1秒添加到任务队列队尾，等待主线程任务执行完，从队头依次执行任务队列中的任务")]),t._v(" "),a("h2",{attrs:{id:"宏任务与微任务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#宏任务与微任务"}},[t._v("#")]),t._v(" 宏任务与微任务")]),t._v(" "),a("p",[t._v("在"),a("code",[t._v("js")]),t._v("中，任务被分为两种，一种是宏任务"),a("code",[t._v("MacroTask")]),t._v("，一种是微任务"),a("code",[t._v("MicroTask")])]),t._v(" "),a("ul",[a("li",[t._v("宏任务包括："),a("code",[t._v("script")]),t._v("、"),a("code",[t._v("setTimeout")]),t._v("、"),a("code",[t._v("setInterval")]),t._v("、"),a("code",[t._v("setImmediate")]),t._v("、"),a("code",[t._v("I/O")]),t._v("、"),a("code",[t._v("UI rendering")])]),t._v(" "),a("li",[t._v("微任务包括："),a("code",[t._v("MutationObserver")]),t._v("、"),a("code",[t._v("Promise.then()或catch()")]),t._v("、"),a("code",[t._v("Node独有的process.nextTick")]),t._v("、"),a("code",[t._v("Promise为基础开发的技术，如fetch")])])]),t._v(" "),a("p",[t._v("举个例子：")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[t._v("console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'script start'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'timer over'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nPromise"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'promise1'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'promise2'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'script end'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// script start")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// script end")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// promise1")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// promise2")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// timer over")]),t._v("\n")])])]),a("p",[t._v("在挂起任务时，JS 引擎会将所有任务按照类别分到这两个队列中，首先在 宏任务 的队列中取出第一个任务，执行完毕后取出 微任务 队列中的所有任务顺序执行；之后再取 宏任务，周而复始，直至两个队列的任务都取完")]),t._v(" "),a("img",{staticClass:"custom",attrs:{src:t.$withBase("/eventloop.png"),alt:"eventloop"}}),t._v(" "),a("h2",{attrs:{id:"eventloop执行顺序"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#eventloop执行顺序"}},[t._v("#")]),t._v(" EventLoop执行顺序")]),t._v(" "),a("p",[t._v("总的来说，"),a("code",[t._v("eventloop")]),t._v("执行过程如下：")]),t._v(" "),a("ol",[a("li",[t._v("一开始一整个脚本作为一个宏任务执行")]),t._v(" "),a("li",[t._v("执行过程中同步代码直接执行，异步任务进入任务队列，其中宏任务进入宏任务队列，微任务进入微任务队列")]),t._v(" "),a("li",[t._v("当前宏任务执行完出队，检查微任务队列列表，有则依次执行完毕")]),t._v(" "),a("li",[t._v("执行浏览器的UI渲染工作")]),t._v(" "),a("li",[t._v("检查是否有"),a("code",[t._v("Web Worker")]),t._v("任务，有则执行")]),t._v(" "),a("li",[t._v("执行完本轮的宏任务，回到2，依次循环，直到宏任务和微任务队列都为空")])])])}),[],!1,null,null,null);s.default=e.exports}}]);